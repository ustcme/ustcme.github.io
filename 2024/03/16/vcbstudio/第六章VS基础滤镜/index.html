<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="Sakura" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Sakura" type="application/atom+xml"><link rel="alternate" type="application/json" title="Sakura" href="https://sakurame.eu.org/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"/><link rel="dns-prefetch" href="https://unpkg.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.11"><link rel="modulepreload" href="/js/chunk-5Y6VMMPJ.js"></link><link rel="modulepreload" href="/js/chunk-BYJYVCTD.js"></link><link rel="modulepreload" href="/js/chunk-PNO2NHAN.js"></link><link rel="modulepreload" href="/js/chunk-XJ6P2B3P.js"></link><link rel="modulepreload" href="/js/copy-tex-AOYBWFMG.js"></link><link rel="modulepreload" href="/js/index.esm-JAJ67G4Q.js"></link><link rel="modulepreload" href="/js/post-3OMOVAIW.js"></link><link rel="modulepreload" href="/js/quicklink-MJWYQOW3.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="modulepreload" href="/js/tcomments-MH65CAA6.js"></link><link rel="preload" href="https://ptpimg.me/5n0t71.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/4ri7s9.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/v5k41w.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/56p569.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/763frg.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/ysg110.jpg" as="image" fetchpriority="high"><meta name="keywords" content="视频压制技术系列教程"/><meta name="description" content="一个专注于技术和思考分享的博客"/><link rel="canonical" href="https://sakurame.eu.org/2024/03/16/vcbstudio/%E7%AC%AC%E5%85%AD%E7%AB%A0VS%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C/"><title>第六章VS基础滤镜</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">第六章VS基础滤镜</h1><div class="meta"><span class="item" title="创建时间：2024-03-16 23:09:01"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2024-03-16T23:09:01+08:00">2024-03-16</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>17k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>16 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Sakura's Blog</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://ptpimg.me/5n0t71.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/4ri7s9.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/v5k41w.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/56p569.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/763frg.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/ysg110.jpg&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/vcbstudio/" itemprop="item" rel="index" title="分类于视频压制技术"><span itemprop="name">视频压制技术<meta itemprop="position" content="0"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://sakurame.eu.org/2024/03/16/vcbstudio/%E7%AC%AC%E5%85%AD%E7%AB%A0VS%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="Sakura"/><meta itemprop="description" content=", 一个专注于技术和思考分享的博客"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sakura"/></span><div class="body md" itemprop="articleBody"><h1 id="第六章-vs基础滤镜"><a class="anchor" href="#第六章-vs基础滤镜">#</a> 第六章 VS 基础滤镜</h1>
<p>本章在上一章的基础上，讲解常用的 VS 基础滤镜。</p>
<h2 id="1-源滤镜"><a class="anchor" href="#1-源滤镜">#</a> 1. 源滤镜</h2>
<p>源滤镜是读取视频源文件并进行解码的滤镜。源滤镜非常重要，其准确性直接关系到整个视频处理流程的可靠与否。</p>
<h3 id="1-lsmas"><a class="anchor" href="#1-lsmas">#</a> (1). lsmas</h3>
<p>lsmas 全称 L-SMASH-Works，是目前最准确的源滤镜。其 VS 版本的文档在：<a target="_blank" rel="noopener" href="https://github.com/AkarinVS/L-SMASH-Works/tree/master/VapourSynth%E3%80%82">https://github.com/AkarinVS/L-SMASH-Works/tree/master/VapourSynth。</a></p>
<p>lsmas 目前提供了两个滤镜： <code>LibavSMASHSource</code>  和  <code>LWLibavSource</code> 。最常用的是  <code>LWLibavSource</code> ，支持各种类型的输入，在第一次读取时会生成  <code>lwi</code>  文件。其次是  <code>LibavSMASHSource</code> ，只支持 mp4 输入，但不需要生成  <code>lwi</code>  文件。</p>
<p>LWLibavSource 有诸多参数，但大多数情况只会用到第一个  <code>source</code> ，指定输入文件路径。 <code>format</code>  参数可以将源转为指定的像素格式，但一般不会使用，都是交给专门的滤镜处理像素格式转换。 <code>fpsnum</code>  和  <code>fpsden</code>  参数可以将源转为指定的帧率而保持视频长度不变，在输入源帧率与目标不匹配时，会进行抽帧和插入重复帧。这在处理一些帧率混乱的源，比如来路不明的 web 流媒体源时可能有用，当然前提是视频平均帧率和目标帧率相差不大。 <code>repeat</code>  用于交错源，将在后续章节中介绍。 <code>prefer_hw</code>  可以使用硬件解码，但任何时候都不要使用这一功能，一是硬解不可靠，二是软解速度大于硬解速度。</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/media/basic-guide-06/image01.png" alt="img" /></p>
<p>lwi 文件需要我们特别关注，这是一个文本文件，记录了各帧的信息，便于准确快速 seek 解码。</p>
<p>每一帧的信息为以下格式：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>Index=0,POS=343715,PTS=625,DTS=375,EDI=0</pre></td></tr><tr><td data-num="2"></td><td><pre>Key=1,Pic=1,POC=15,Repeat=1,Field=0</pre></td></tr></table></figure><p><code>PTS</code>  呈现时间戳，即帧呈现到屏幕上的时间； <code>DTS</code>  解码时间戳，即解码器必须解码这一帧的时间。这两者的单位取决于 lwi 开头部分的 TimeBase 参数，1/1000 表示单位为 1 毫秒，因此你可以通过 PTS 和视频帧率，算出每一帧对应的帧号。lwi 中各帧按照 DTS 从小到大排列。<br />
 <code>KEY</code>  表示是否为关键帧 IDR，1 代表是 IDR，可以从这帧开始独立解码。 <code>Pic</code>  表示帧类型，1 代表 I 帧，2 代表 P 帧，3 代表 B 帧。 根据 lwi 的帧信息我们可以判断 GOP，从一个 KEY=1 的 IDR（含）到下一个 KEY=1 的 IDR（不含）就为一个 GOP。</p>
<p>严格来说 KEY=1 表示 RAP（random access point），比 IDR 更进一步，表示可以从这帧开始完全重新解码。IDR  表示后续的帧不会再依赖前面的帧，但是并不保证不需要前面的数据。实际解码中，除了帧数据还有一些全局或半全局的参数，学名 VPS（video  parameter set）和 SPS（sequence parameter set），它们为编码器提供一些必要的设置参数。lwi 的  key=1 说的是包括了 SPS 的 IDR 帧，因此可能发现有些 IDR 帧是 Key=0。</p>
<h3 id="2-ffms2"><a class="anchor" href="#2-ffms2">#</a> (2). ffms2</h3>
<p>ffms2 全称 FFmpeg Source 2，是另一个广泛使用的源滤镜。<a target="_blank" rel="noopener" href="https://github.com/FFMS/ffms2%E3%80%82">https://github.com/FFMS/ffms2。</a></p>
<p>基本用法如下：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>src <span class="token operator">=</span> core<span class="token punctuation">.</span>ffms2<span class="token punctuation">.</span>Source<span class="token punctuation">(</span><span class="token string">"00001.m2ts"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们一般不会使用 ffms2，因为不如 lsmas 准确，只有遇到极少的 lsmas 出错的情况才会使用它进行对照。ffms2 也会生成类似的索引文件，后缀为  <code>ffindex</code> ，但是生成索引时不显示进度条，这是其另一大缺点。</p>
<h3 id="3-imwri"><a class="anchor" href="#3-imwri">#</a> (3). imwri</h3>
<p>imwri 全称 ImageMagick Writer-Reader，区别于前两者，imwri 是一个专用于图片的滤镜。<a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/plugins/imwri.html%E3%80%82">https://amusementclub.github.io/doc/plugins/imwri.html。</a></p>
<p>基本用法如下：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>src <span class="token operator">=</span> core<span class="token punctuation">.</span>imwri<span class="token punctuation">.</span>Read<span class="token punctuation">(</span><span class="token string">"01.png"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>事实上 lsmas 也可以读取图片，并且对于 JPG 这种 YUV 格式的，会保留原始数据，而 imwri 则将输入全转为 RGB。</p>
<p>但是 lsmas 有一定的局限性，不支持奇数高的 YUV420 格式图片。对于 YUV420  格式的图片，由于色度半采样，理论上是不支持奇数高的，图片制作时一般是增加一个不可见的行使其对齐来编码。lsmas  解码时只输出有效的奇数行，而后续其他滤镜都不支持这种奇特的格式，导致无法预览。</p>
<p>另外 imwri 还提供了  <code>Write</code>  滤镜，可以简单地批量导出图片。</p>
<h2 id="2-基础视频操作滤镜"><a class="anchor" href="#2-基础视频操作滤镜">#</a> 2. 基础视频操作滤镜</h2>
<h3 id="1-trim-splice"><a class="anchor" href="#1-trim-splice">#</a> (1). Trim / Splice</h3>
<p>视频的分割与合并，在 VS 里通过  <code>Trim</code>  和  <code>Splice</code>  滤镜来完成。</p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/trim.html">https://amusementclub.github.io/doc/functions/video/trim.html</a></p>
<p>Trim 一般通过下面方式使用，指定切割的起始帧和结束帧，区间是左闭右闭。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token punctuation">.</span>Trim<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> first<span class="token punctuation">,</span> last<span class="token punctuation">)</span></pre></td></tr></table></figure><p>如果你写  <code>std.Trim(clip, 0, 100)</code> ，那么会切出 0-100 总共 100-0+1=101 帧。</p>
<p>在 python 里还可以使用  <code>[]</code>  的语法糖来进行切割，写法是  <code>[first: last+1]</code> ，注意这里是左闭右开。<br />
如果你写  <code>clip[0: 100]</code> ，那么会切出 0-99 总共 100-0=100 帧。</p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/splice.html">https://amusementclub.github.io/doc/functions/video/splice.html</a></p>
<p>与切割相对的是合并 Splice，通过下面方式使用。一般要求它们的属性全部一致，包括画面大小，像素类型。帧率可以不一致，不过 VS 处理可变帧率是个麻烦事，后续章节会讲。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token punctuation">.</span>Splice<span class="token punctuation">(</span><span class="token punctuation">[</span>clip1<span class="token punctuation">,</span> clip2<span class="token punctuation">,</span> clip3<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>也有对应的语法糖， <code>clip1 + clip2 + clip3</code> 。简单易懂，因此实际使用更推荐后一种方式。</p>
<p>如果希望合并多个相同 clip，可以使用乘法。 <code>clip * 3</code> ，就是将视频重复三次。<br />
这等价于  <code>Loop</code>  滤镜： <code>core.std.Loop(clip, times)</code> 。</p>
<h3 id="2-interleave-selectevery"><a class="anchor" href="#2-interleave-selectevery">#</a> (2). Interleave / SelectEvery</h3>
<p><code>Interleave</code>  滤镜，上一章已经讲过，可以将多个视频交替输出。与之相对的是  <code>SelectEvery</code> ，按照一定的步长，选取部分帧。</p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/selectevery.html">https://amusementclub.github.io/doc/functions/video/selectevery.html</a></p>
<p>选取所有偶数帧：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token punctuation">.</span>SelectEvery<span class="token punctuation">(</span>clip<span class="token operator">=</span>clip<span class="token punctuation">,</span> cycle<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> offsets<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>选取所有奇数帧：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token punctuation">.</span>SelectEvery<span class="token punctuation">(</span>clip<span class="token operator">=</span>clip<span class="token punctuation">,</span> cycle<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> offsets<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>也有对应的语法糖： <code>clip[::2]</code>  和  <code>clip[1::2]</code> 。</p>
<h3 id="3-crop-addborders"><a class="anchor" href="#3-crop-addborders">#</a> (3). Crop / AddBorders</h3>
<p>视频的裁剪，在 VS 里通过  <code>Crop</code>  滤镜来完成。</p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/crop_cropabs.html">https://amusementclub.github.io/doc/functions/video/crop_cropabs.html</a></p>
<p>有两种用法：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token punctuation">.</span>Crop<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>std<span class="token punctuation">.</span>CropAbs<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>Crop</code>  指定左右上下分别裁剪多少像素。 <code>CropAbs</code>  先指定裁剪后视频的宽高，然后指定左上分别裁剪多少像素。</p>
<p>Crop 一般用于裁剪黑边，比如原生 4:3 的视频，加黑边加到 1920x1080，那么有效部分是 1440x1080。</p>
<p>用 Crop 可以写为：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>cropped <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>Crop<span class="token punctuation">(</span>src<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token number">240</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token number">240</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>也可以用 CropAbs 写为：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>cropped <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>CropAbs<span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token number">1440</span><span class="token punctuation">,</span> <span class="token number">1080</span><span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token number">240</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/addborders.html">https://amusementclub.github.io/doc/functions/video/addborders.html</a></p>
<p>与裁剪相对的，我们也可以使用  <code>AddBorders</code>  来加黑边。</p>
<p>比如给 1440x1080 的视频加黑边到 1920x1080。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>addborders <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>AddBorders<span class="token punctuation">(</span>src<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token number">240</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token number">240</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="4-shuffleplanes-splitplanes"><a class="anchor" href="#4-shuffleplanes-splitplanes">#</a> (4). ShufflePlanes / SplitPlanes</h3>
<p>对视频平面进行操作，使用的是  <code>ShufflePlanes</code>  和  <code>SplitPlanes</code>  两个滤镜。</p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/splitplanes.html">https://amusementclub.github.io/doc/functions/video/splitplanes.html</a></p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/shuffleplanes.html">https://amusementclub.github.io/doc/functions/video/shuffleplanes.html</a></p>
<p>我们知道 YUV 和 RGB 都有三个平面，可以使用 SplitPlanes 将其拆分。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>Y<span class="token punctuation">,</span> U<span class="token punctuation">,</span> V <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>SplitPlanes<span class="token punctuation">(</span>src<span class="token punctuation">)</span></pre></td></tr></table></figure><p>这也可以通过 ShufflePlanes 得到。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>Y <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>ShufflePlanes<span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> vs<span class="token punctuation">.</span>GRAY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>U <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>ShufflePlanes<span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> vs<span class="token punctuation">.</span>GRAY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>V <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>ShufflePlanes<span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> vs<span class="token punctuation">.</span>GRAY<span class="token punctuation">)</span></pre></td></tr></table></figure><p>观察这些单个平面，会发现它们都以灰度图显示，我们可以通过下述方式观察单个平面的效果。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>mid <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>BlankClip<span class="token punctuation">(</span>src<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>clipU <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>ShufflePlanes<span class="token punctuation">(</span><span class="token punctuation">[</span>mid<span class="token punctuation">,</span> U<span class="token punctuation">,</span> mid<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vs<span class="token punctuation">.</span>YUV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>clipV <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>ShufflePlanes<span class="token punctuation">(</span><span class="token punctuation">[</span>mid<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> V<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vs<span class="token punctuation">.</span>YUV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>clipU<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>clipV<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这个例子也显示了 ShufflePlanes 的复杂用法， <code>clips</code>  和  <code>planes</code>  两个参数都可以是列表。planes 的元素数量表示了结果 clip 的平面数量，其中第 i 个元素表示从 clips 列表第 i 个 clip 获取平面的序号。<br />
以  <code>clipU</code>  为例， <code>planes=[0, 0, 2]</code>  表示输出有 3 个平面，第一个平面取自 mid 的 0 平面，第二个平面取自 U 的 0 平面，第三个平面取自 mid 的 2 平面。</p>
<p>这种用法也允许 clips 的元素数量少于 planes 元素数量，此时 clips 将会由其最后一个元素填充至与 planes 元素数量相等。如下面这个例子中， <code>clips=[Y, mid]</code> ，实际等价于  <code>[Y, mid, mid]</code> 。<br />
另外，观察这个  <code>clipY</code>  结果会发现与单独预览 Y 的结果一致，因此实际中观察 Y 的效果只需抽取单个平面即可。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>clipY <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>ShufflePlanes<span class="token punctuation">(</span><span class="token punctuation">[</span>Y<span class="token punctuation">,</span> mid<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vs<span class="token punctuation">.</span>YUV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>clipY<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="3-精度转换"><a class="anchor" href="#3-精度转换">#</a> 3. 精度转换</h2>
<h3 id="1-高精度与range"><a class="anchor" href="#1-高精度与range">#</a> (1). 高精度与 Range</h3>
<h4 id="range"><a class="anchor" href="#range">#</a> Range</h4>
<p>在第一章我们了解了 range 的概念，即量化像素数据的取值范围。range 可以分为  <code>limited range</code>  和  <code>full range</code> 。RGB 一般总是 full range，而 YUV 一般总是 limited range（除了 jpg 图片、YCgCo）。</p>
<p>我们知道，8bit 下 limited range 是：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>Y  [16, 235]</pre></td></tr><tr><td data-num="2"></td><td><pre>UV [16, 240]</pre></td></tr></table></figure><p>10bit 下 limited range 是：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>Y  [16*2^2, 235*2^2] = [64, 940]</pre></td></tr><tr><td data-num="2"></td><td><pre>UV [16*2^2, 240*2^2] = [64, 960]</pre></td></tr></table></figure><p>一般地，range 通过如下方式定义：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>limited:</pre></td></tr><tr><td data-num="2"></td><td><pre>Y   [16*2^(bit-8), 235*2^(bit-8)]</pre></td></tr><tr><td data-num="3"></td><td><pre>UV  [16*2^(bit-8), 240*2^(bit-8)]</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>full:</pre></td></tr><tr><td data-num="6"></td><td><pre>YUV [0, 2^bit-1]</pre></td></tr></table></figure><p>这样 16bit 下 limited range 是：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>Y  [4096, 60160]</pre></td></tr><tr><td data-num="2"></td><td><pre>UV [4096, 61440]</pre></td></tr></table></figure><p>数据在不同精度和不同 range 间以浮点值作为不变量进行转换，可以总结转换公式为：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>dst_value = (src_value - src_zero) / (src_max - src_min) * (dst_max - dst_min) + dst_zero</pre></td></tr></table></figure><p>不难证明，在目的和源的 range 都为 limited 时，可以通过乘 / 除以  <code>2^(dst_bit - src_bit)</code>  来进行转换。</p>
<h4 id="vs精度转换"><a class="anchor" href="#vs精度转换">#</a> VS 精度转换</h4>
<p>通常视频都是 8bit 或者 10bit，而在 VS 中经常会使用更高精度比如 16bit 来进行处理。</p>
<p>VS 中用来转换精度的有 fmtc 和 zimg 两个工具，前者是使用  <code>fmtc.bitdepth</code>  滤镜，后者是使用  <code>resize</code>  系列滤镜。</p>
<p>fmtc 全名 format conversion tools，文档在这里：<a target="_blank" rel="noopener" href="https://amusementclub.github.io/fmtconv/doc/fmtconv.html%E3%80%82">https://amusementclub.github.io/fmtconv/doc/fmtconv.html。</a></p>
<p>假设输入源为 8bit，用 fmtc 转为 16bit 的写法为：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>src16 <span class="token operator">=</span> core<span class="token punctuation">.</span>fmtc<span class="token punctuation">.</span>bitdepth<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>当然，也可以通过  <code>fulls</code>  和  <code>fulld</code>  参数显式指定输入和输出的 range。如果不指定，输出 range 总是等于输入 range，而输入 range 通过数据类型来猜测，YUV 总是猜测为 limited range。</p>
<p>resize，VS 的内置滤镜，文档在这里：<a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/resize.html%E3%80%82">https://amusementclub.github.io/doc/functions/video/resize.html。</a></p>
<p>虽然名字叫 resize，但实际却是 VS 中的瑞士军刀，集成了包含缩放在内的多种功能，这里我们用到的是转换精度的功能。</p>
<p>同样假设输入源为 8bit，转为 16bit 的写法为：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>src16 <span class="token operator">=</span> core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Bicubic<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span>vs<span class="token punctuation">.</span>YUV420P16<span class="token punctuation">)</span></pre></td></tr></table></figure><p>resize 可以通过  <code>range</code>  和  <code>range_in</code>  参数显式指定输入和输出的 range。与 fmtc 不同，在未指定 range 时，resize 会优先通过 frameprops 来决定 range。</p>
<p>顺便一提，在 resize 的参数中，有  <code>_in</code>  后缀的指输入，没有  <code>_in</code>  后缀的都是指输出，这些参数都通过一个 magic number 来指定。同时，resize 还提供了一套  <code>_s</code>  后缀的参数，可以使用字符串来指定。对于 range、matrix 这类需要指定 magic number 的参数，我们都强烈建议使用字符串形式，或者使用 magic number 对应的 enum 来指定，以提高脚本的可读性，防止出错。</p>
<p>除了直接使用以上两个滤镜，还可以通过  <code>mvf</code>  中的 wrapper 来进行转换。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>src16 <span class="token operator">=</span> mvf<span class="token punctuation">.</span>Depth<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>在未显示指定  <code>fulls</code>  和  <code>fulld</code>  时， <code>mvf.Depth</code>  通过输入视频格式来猜测 range，对于 YUV 和 GRAY，总是猜测为 limited，其他格式为 full。</p>
<h4 id="vs中的format表示"><a class="anchor" href="#vs中的format表示">#</a> VS 中的 format 表示</h4>
<p>GRAY 和 RGB 都是采用  <code>GRAY+X</code> 、 <code>RGB+X</code>  的形式，这里 X 可以是一个数字，表示整数类型的位宽，也可以是一个字母，表示浮点类型的位宽。H 表示 half，半精度浮点数，fp16。S 表示 single，单精度浮点数，fp32。</p>
<p>YUV 则有些区别，采用  <code>YUV+css+P+X</code>  的形式。css 表示色度下采样，常见有 444、422、420 等。P 表示三个平面的存放方式为 planar，也就是三个平面分开存放。最后 X 与 GRAY 和 RGB 相同，可以是代表整型位宽的数字，也可以是代表浮点类型的字母。</p>
<p>需要注意的是，fmtc 和 mvf.Depth 中指定的 bit 数，默认 16 表示 int 16，而 32 表示 float 32。</p>
<h4 id="yuv-overflow-underflow"><a class="anchor" href="#yuv-overflow-underflow">#</a> YUV overflow / underflow</h4>
<p>通常我们遇到的 YUV 视频都是 limited range，但如果有这样一个视频，其内容是 full range 的，却被标成了 limited range，会发生什么？<br />
这时超过 limited range 范围的部分将被截断在 limited range 的极值上，全部变成一种颜色，分辨不出其中的细节了。</p>
<p>这种现象就被称为 YUV 越界，又叫 YUV overflow /underflow。超过最大值，称为上溢，overflow；超过最小值，称为下溢，underflow。<br />
实际中上溢和下溢可以同时发生，也可以分别独立发生。一般来说，上溢单独发生的情况要远多于其他情况。</p>
<p>在 VS 中，我们通常用  <code>core.hist.Levels()</code>  滤镜观察是否发生越界。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>res <span class="token operator">=</span> core<span class="token punctuation">.</span>hist<span class="token punctuation">.</span>Levels<span class="token punctuation">(</span>src8<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>res<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>可以看到，在画面的右侧出现了三个直方图，从上到下分别表示 YUV 三个平面的像素值分布情况。每个直方图的横坐标是像素值，从左到右是 0 到 255；纵坐标是该值对应的像素数量。</p>
<p>图像中间没有阴影的区域，表示 limited range，两端的阴影区域，表示超过 limited range 的区域。如果我们发现，直方图超出中间而到达两端的区域，就说明发生了越界。</p>
<p>在原盘的 OP 和 ED 部分，可能会有少量越界，这大多是后期添加的 staff 字幕带来的，白色字幕可能会越界几个像素，到达 240 左右。这种情况一般不需要处理，事实上我们反而会利用字幕颜色越界的特性来框选它们。</p>
<p>对于现在的新番，YUV 越界很少在动画正片中出现，但是时常在三次元特典中发生，一般习惯拿到三次元特典上来先检查 YUV 范围。如果发现视频中大段出现亮度越界的现象，那就需要提起注意，这个视频很可能有 range 问题。</p>
<p>判断确实发生了越界，就需要进行处理，将数据范围从 full 压缩到 limited。为了保证这一操作的精度，通常会在 16bit 下进行。在 VS 中， <code>Levels</code>  滤镜专门用来处理越界问题。</p>
<p>假设一个视频发生了亮度 overflow，可以使用以下方式修复：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>src16 <span class="token operator">=</span> core<span class="token punctuation">.</span>fmtc<span class="token punctuation">.</span>bitdepth<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>src16 <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>Levels<span class="token punctuation">(</span>src16<span class="token punctuation">,</span> min_in<span class="token operator">=</span><span class="token number">16</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> max_in<span class="token operator">=</span><span class="token number">255</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> min_out<span class="token operator">=</span><span class="token number">16</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> max_out<span class="token operator">=</span><span class="token number">235</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> planes<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>当然，实际情况中你需要分别判断 overflow 和 underflow 是否发生，并找到它们溢出的最大值、最小值来确定 max_in 和 min_in。</p>
<h3 id="2-降精度与dither"><a class="anchor" href="#2-降精度与dither">#</a> (2). 降精度与 Dither</h3>
<p>经过一系列高精度的处理，在最后输出给编码器时，我们需要将精度降为 8bit 或者 10bit。通过之前的转换公式我们知道，从高精度降为低精度时，多个高精度值会被转为同一个低精度值，这样在相邻颜色间就会形成明显的分界线，或者说色带。</p>
<p>为了效果明显，我们使用 8bit 降为 4bit 来展现这一过程，这里使用 round（四舍五入）来处理。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>src4 <span class="token operator">=</span> mvf<span class="token punctuation">.</span>Depth<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> dither<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>可以看到降低精度后的图片出现了很多明显的色带，这是我们难以接受的。<br />
为了解决这种色带问题，很自然的想法是，加点噪声，让相邻颜色之间的台阶看起来没那么陡峭。<br />
这种引入类似噪声的方法，就称作抖动（dither）。</p>
<p>最简单的抖动算法， <code>ordered dither</code> ，又叫 Bayer matrix，在 fmtc 和 mvf 里是  <code>dmode=0</code> 。</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/media/basic-guide-06/image04.png" alt="img" /></p>
<p>现在我们可以看到，色带问题得到了极大的改善。仔细观察，则会看到画面上充满了规则排列的点状图样。</p>
<p>这种 dither 过程中引入的丑陋噪点也被叫做 dither pattern，它们在进一步缩放后会更加明显。平时 QQ 聊天中，在那些被压缩过的缩略图上，经常可以看到这种现象。</p>
<p>ordered dither 虽然丑陋，但有这些好处：<br />
1. 算起来很快<br />
 2. 很难被编码器抹平</p>
<p>我们通常会利用它很难被抹平的特点，将它用在 8bit 低码率成品的暗场中，防止出现色带。</p>
<p>那么有没有更高质量的 dither 算法呢，当然是有的，最常使用的是  <code>error diffusion</code>  误差扩散。</p>
<p>fmtc 中提供了很多 error diffusion 的变体，差别不大，一般使用  <code>dmode=3</code> ，最经典的 error diffusion，这也是 fmtc 和 mvf.Depth 的默认算法。</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/media/basic-guide-06/image05.png" alt="img" /></p>
<h2 id="4-初等resizer"><a class="anchor" href="#4-初等resizer">#</a> 4. 初等 Resizer</h2>
<p>Resizer 是滤镜中的瑞士军刀，它能处理多种基础视频操作，也在一些高级处理手段中发挥重要作用，这些我们会在后续章节中逐渐看到。在本章我们仅关注 Resizer 最基本的用法，视频缩放。</p>
<p>VS 中使用 resizer 有 fmtc 和 zimg 两个工具，前者是使用  <code>fmtc.resample</code>  滤镜，后者是使用 VS 自带的  <code>resize.*</code>  系列滤镜。</p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/doc/functions/video/resize.html">https://amusementclub.github.io/doc/functions/video/resize.html</a></p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/fmtconv/doc/fmtconv.html#resample">https://amusementclub.github.io/fmtconv/doc/fmtconv.html#resample</a></p>
<h3 id="1-resizer的副作用"><a class="anchor" href="#1-resizer的副作用">#</a> (1). resizer 的副作用</h3>
<p>可以看到，这些滤镜里面提供了很多不同的算法，为了更好地使用它们，我们需要了解这些算法的优势和劣势所在。</p>
<p>大部分 resize 滤镜都逃不过这三种副作用：模糊（blurring）、锯齿（aliasing）、振铃（ringing）。</p>
<h4 id="模糊blurring"><a class="anchor" href="#模糊blurring">#</a> 模糊（blurring）</h4>
<p>模糊很好理解，就是缩放后画面变糊了。</p>
<p>可以通过下面这段代码感受模糊的效果，其中  <code>upscale_0</code>  是使用 nearest 算法，单纯复制原来的像素，锐利度几乎不变，而  <code>upscale_1</code>  使用 bilinear 算法，通过线性插值得到结果，图像有明显的模糊现象。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>upscale_0 <span class="token operator">=</span> core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Point<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> src8<span class="token punctuation">.</span>width<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> src8<span class="token punctuation">.</span>height<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>upscale_1 <span class="token operator">=</span> core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Bilinear<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> src8<span class="token punctuation">.</span>width<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> src8<span class="token punctuation">.</span>height<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>upscale_0<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>upscale_1<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>大部分时候我们总是不希望画面变糊的，但是在放大 UV 平面的时候我们就可以用一些比较糊的滤镜。原因是，UV 平面本就信息量不高，而编码器还会疯狂剥削 UV 平面，导致有时候 UV  平面质量很差。这时候使用一些锐利的放大滤镜，反而会放大 UV 平面的瑕疵，而用一些模糊的滤镜可以 “一糊遮百丑”。</p>
<p>另一方面，UV 平面的锐利度其实对观看体验的影响不大。观察下面这段代码的结果，对比  <code>u1</code>  和  <code>u2</code>  可以发现色度平面被严重模糊，而对比  <code>res1</code>  和  <code>res2</code>  则发现最后呈现结果区别很小。因此，拉伸 UV 平面基本没必要选用特别锐利的滤镜，区别实在不是很明显。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>res1 <span class="token operator">=</span> src8</pre></td></tr><tr><td data-num="2"></td><td><pre>res2 <span class="token operator">=</span> core<span class="token punctuation">.</span>rgvs<span class="token punctuation">.</span>RemoveGrain<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>u1 <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>ShufflePlanes<span class="token punctuation">(</span>res1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> vs<span class="token punctuation">.</span>GRAY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>u2 <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>ShufflePlanes<span class="token punctuation">(</span>res2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> vs<span class="token punctuation">.</span>GRAY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>res1<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>res2<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>u1<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>u2<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="锯齿aliasing"><a class="anchor" href="#锯齿aliasing">#</a> 锯齿（aliasing）</h4>
<p>锯齿很好观察，使用 nearest 进行非整数的缩放，满屏幕都是锯齿。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>upscale <span class="token operator">=</span> core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Point<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> src8<span class="token punctuation">.</span>width<span class="token operator">*</span><span class="token number">1.75</span><span class="token punctuation">,</span> src8<span class="token punctuation">.</span>height<span class="token operator">*</span><span class="token number">1.75</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>upscale<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="振铃ringing"><a class="anchor" href="#振铃ringing">#</a> 振铃（ringing）</h4>
<p>至于 ringing，通常出现在比较锐利的 resizer 中。选用清晰度较高的源，使用 Lanczos 之类锐利的滤镜，可以看到线条周围一圈发亮的东西，就是 ringing。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>upscale <span class="token operator">=</span> core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Lanczos<span class="token punctuation">(</span>src8<span class="token punctuation">,</span> src8<span class="token punctuation">.</span>width<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> src8<span class="token punctuation">.</span>height<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> filter_param_a<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>upscale<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="2-图像的缩放"><a class="anchor" href="#2-图像的缩放">#</a> (2). 图像的缩放</h3>
<p>通常人们会认为数字图像是由一堆相同大小的正方形像素块组成，这种观念实际上是错误的。实际上，我们应该把图像看做一块连续的平面，而像素是其上没有大小只有坐标的采样点。只要采样的数量足够多，那我们就可以用这些分立的点表示整幅图像。</p>
<p>缩放图像，则应该理解为图像平面本身没有变化，而只是增加或减少采样点数量，或者说密度。</p>
<p>以下面这幅图像为例，现在有 4 个像素，坐标分别是： <code>(0,0), (0,1), (1,0), (1,1)</code> 。</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/media/basic-guide-06/image06.png" alt="img" /></p>
<p>现在我们希望将图像的宽高都放大两倍，最终有 16 个像素。按照中心对齐，现在这些像素的位置如下图红点所示。</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/media/basic-guide-06/image07.png" alt="img" /></p>
<p>可以发现这些新像素在原来坐标系下处于小数坐标的位置，而这些位置是没有准确值的，因此我们只能通过周围已知像素，猜测这些位置的值，这被称为插值（interpolation）。</p>
<p>插值有两个关键点，一是  <code>taps</code> ，即选取周围多大范围的已知像素；二是  <code>weight</code> ，即这些选中的像素的权重是多少。</p>
<p><code>taps</code>  很好理解，就是选取范围的半径，选取的周围像素越多，“猜测” 就越可能准确。但同时，涉及的像素越多，计算也就越慢。</p>
<p><code>weight</code>  也容易理解，比如图上  <code>(1,0)</code>  和  <code>(1,1)</code>  位置的像素到  <code>(0.25, 1.25)</code>  采样点的距离不同，它们所占的比重自然也是不一样的。</p>
<p>在实际中，我们使用  <code>kernel</code>  来描述以上性质。kernel 是一个曲线，它的横坐标表示已知像素到采样点的距离，纵坐标表示在这个距离上，该像素贡献的权值。taps 也在曲线上有所表现，超过 taps 范围的像素没有贡献，因此曲线恒为 0。</p>
<p><a target="_blank" rel="noopener" href="https://amusementclub.github.io/ResampleHQ/kernels.html">https://amusementclub.github.io/ResampleHQ/kernels.html</a></p>
<p>可以通过这个网页查看各种 kernel 的形状，将鼠标移到曲线下方的 kernel 名字上可以显示对应的 kernel 曲线，同时也可以在最下方的直方图上看到各个  kernel 对应的 blurring、sharpness、ringing 三种性质。不过需要注意的是，这里讲的 kernel  性质是数学上的定义，和我们前面讲的视觉上的概念还有些区别。</p>
<p>最后，我们通过这张图来形象地说明 2 维图片的插值过程。<br />
如图所示，先是在横向上进行插值，算出中间点，然后纵向上再利用这些中间点，进一步插值算出目标点。<br />
这一过程体现出，横向和纵向的插值是完全独立的，事实上，我们甚至可以在两个方向使用完全不同的算法。<br />
另外，这幅图也展示了，不同 taps 的插值算法会利用到的周围像素范围。</p>
<p>![img](<a target="_blank" rel="noopener" href="https://guides.vcb-s.com/media/basic-guide-06/image08">https://guides.vcb-s.com/media/basic-guide-06/image08</a> interpolation.png)</p>
<h3 id="3-resizer的使用"><a class="anchor" href="#3-resizer的使用">#</a> (3). resizer 的使用</h3>
<p>接下来我们就结合 kernel 曲线，依次介绍常见的 resizer。</p>
<h4 id="pointnearest"><a class="anchor" href="#pointnearest">#</a> Point(Nearest)</h4>
<p>首先是  <code>nearest</code> ，最常见的算法之一，它可以说没有插值，只是单纯采样最近的像素。这里没有提供它的 kernel 曲线，但根据性质描述应该不难画出。由于它只采样最近的像素，显然是  <code>1-taps</code>  的。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Point<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>core<span class="token punctuation">.</span>fmtc<span class="token punctuation">.</span>resample<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">"point"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="bilinear"><a class="anchor" href="#bilinear">#</a> Bilinear</h4>
<p><code>bilinear</code> ，中文名双线性。它分别对 x 和 y 方向各做了一次线性插值，因此得名双线性。观察 kernel 可以看出其线性的性质，同时可以看出它是  <code>1-taps</code>  的。</p>
<p>双线性特点是计算快，不那么锐利，有些锯齿，没有 ringing，各方面比较平庸。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Bilinear<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>core<span class="token punctuation">.</span>fmtc<span class="token punctuation">.</span>resample<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">"bilinear"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="bicubic"><a class="anchor" href="#bicubic">#</a> Bicubic</h4>
<p><code>bicubic</code> ，中文名双立方。区别于 bilinear 的线性插值，bicubic 在每个方向选取最近的四个点，用三次多项式插值计算，因此得名双立方。</p>
<p>bicubic 有两个专有的参数， <code>b</code>  和  <code>c</code> 。大致可以理解为 b 越大越模糊，c 越大越锐利。这两个参数在 resize 函数里叫  <code>filter_param_a</code>  和  <code>filter_param_b</code> ，在 resample 函数里叫  <code>a1</code>  和  <code>a2</code> 。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Bicubic<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> filter_param_a<span class="token operator">=</span>b<span class="token punctuation">,</span> filter_param_b<span class="token operator">=</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>core<span class="token punctuation">.</span>fmtc<span class="token punctuation">.</span>resample<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">"bicubic"</span><span class="token punctuation">,</span> a1<span class="token operator">=</span>b<span class="token punctuation">,</span> a2<span class="token operator">=</span>c<span class="token punctuation">)</span></pre></td></tr></table></figure><p>bicubic 中不同的 bc 组合有不同的性质。在提出 bicubic 算法的那篇论文里，作者用不同的 bc 参数组合做了很多图，然后让图像处理的专业人士去评价，得到以下结果。</p>
<p>![img](<a target="_blank" rel="noopener" href="https://guides.vcb-s.com/media/basic-guide-06/image09">https://guides.vcb-s.com/media/basic-guide-06/image09</a> bicubic.png)</p>
<p>blur 和 ringing 我们前面讲过，这里的 anisotropy，各向异性，指的是横竖方向和斜的方向，这个滤镜的效果出现了明显不同，导致看起来会有锯齿的感觉。</p>
<p>最终，论文作者推荐了  <code>b=1/3, c=1/3</code>  的参数，也就是以两位作者名字命名的  <code>Mitchell-Netravali</code>  算法。</p>
<p>还有一些比较经典的取值，比如  <code>Catmull-Rom</code> ， <code>b=0.0 c=0.5</code> 。过去经常在处理 chroma 时使用。</p>
<p><code>softcubic</code> ，指一系列参数，满足  <code>b=x, c=1-x</code> ，就叫  <code>softcubic(100*x)</code> 。其中  <code>softbubic100</code> ， <code>b=1.0 c=0.0</code> ，又称为  <code>b-spline</code> 。</p>
<h4 id="spline"><a class="anchor" href="#spline">#</a> Spline</h4>
<p><code>spline</code>  系列，taps 是可调的。它的命名原则是，如果一个 spline 是 n-taps 的那么它叫  <code>spline((2n)^2)</code> 。</p>
<p>spline16 是 2-taps，spline36 是 3-taps，spline64 是 4-taps。</p>
<p>spline 系列比较柔和，出 ringing 较少，常用于 downscale。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Spline36<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>core<span class="token punctuation">.</span>fmtc<span class="token punctuation">.</span>resample<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">"spline36"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="lanczos"><a class="anchor" href="#lanczos">#</a> Lanczos</h4>
<p><code>lanczos</code>  系列，taps 也是可调的。如果一个 lanczos 是 n-taps 的那么它叫  <code>lanczos(n)</code> 。</p>
<p>lanczos 较为锐利，通常也会带来比较重的 ringing。过去常用 lanczos4 配合 no-ringing 用于放大。</p>
<p>在 resize 函数中通过  <code>filter_param_a</code>  指定 taps，在 resample 函数中通过  <code>taps</code>  参数指定 taps。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>core<span class="token punctuation">.</span>resize<span class="token punctuation">.</span>Lanczos<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> filter_param_a<span class="token operator">=</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>core<span class="token punctuation">.</span>fmtc<span class="token punctuation">.</span>resample<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">"lanczos"</span><span class="token punctuation">,</span> taps<span class="token operator">=</span>n<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="gauss"><a class="anchor" href="#gauss">#</a> Gauss</h4>
<p>高斯滤镜，名字来源于其 kernel，这个曲线是按高斯分布（正态分布）画的。</p>
<p>resample 里可以使用 gauss，resize 则没有该滤镜。滤镜有两个参数， <code>a1</code>  和  <code>taps</code> 。 <code>a1</code>  是 1-100 的实数，与高斯分布的 sigma 相关，越小越模糊。 <code>taps</code>  指定需要采样的像素范围，由于高斯分布曲线是向两端无限延伸的，因此需要确定实际采样的半径。</p>
<p>gauss 通常用于配合其他滤镜，比如配合 lanczos 做 no-ringing 的放大，这会在后续课程中提到。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>core<span class="token punctuation">.</span>fmtc<span class="token punctuation">.</span>resample<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">"gauss"</span><span class="token punctuation">,</span> a1<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> taps<span class="token operator">=</span>n<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="nnedi3"><a class="anchor" href="#nnedi3">#</a> nnedi3</h4>
<p>最后介绍一个实际中广泛使用的神经网络放大滤镜， <code>nnedi3</code> 。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/dubhater/vapoursynth-nnedi3">https://github.com/dubhater/vapoursynth-nnedi3</a></p>
<p>这个滤镜最开始其实不是用来放大的，而是用于反交错的。它的作用是在每两行像素中插入一行，也就是说，原始版本的 nnedi3 只能把原图的高变成两倍。</p>
<p>假如想放大宽，那么需要把图竖起来送进 nnedi3，可以利用  <code>std.Transpose()</code>  滤镜。</p>
<p>在 VS 中，调用 nnedi3 进行倍高是这样：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>core<span class="token punctuation">.</span>znedi3<span class="token punctuation">.</span>nnedi3<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> field<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> dh<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>需要注意的是，手动倍高进行放大会产生 chroma shift 问题，这会在后续课程进行介绍。目前推荐的用法是，使用  <code>nnedi3_resample.py</code>  这个 wrapper，它将 nnedi3 封装成和其他 resizer 类似。在 nnedi3_resample 里面， <code>width</code>  和  <code>height</code>  不再需要是两倍，脚本会将输入用 nnedi3 2/4/8... 倍拉到比较合适的大小后，再调用传统的 resizer 拉到目标尺寸。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> nnedi3_resample <span class="token keyword">as</span> nnrs</pre></td></tr><tr><td data-num="2"></td><td><pre>upscale <span class="token operator">=</span> nnrs<span class="token punctuation">.</span>nnedi3_resample<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"znedi3"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="5-字幕滤镜"><a class="anchor" href="#5-字幕滤镜">#</a> 5. 字幕滤镜</h2>
<p>字幕滤镜按照渲染标准不同分为  <code>VSF</code>  系和  <code>libass</code>  系。前者以 VSFilter 这一经典字幕滤镜为基础，遵循传统的事实标准。libass 则是近年来新起的 ass 标准。</p>
<p>在压片中具体使用哪个，需要根据具体情况来确定。对于老字幕，只有 VSF 一种选择；而对于较新的字幕，需要询问字幕组，保证和字幕组制作字幕时使用的一致。</p>
<h3 id="1-vsf系字幕滤镜"><a class="anchor" href="#1-vsf系字幕滤镜">#</a> (1). VSF 系字幕滤镜</h3>
<p>VSF 系一般使用  <code>xy-VSFilter</code> ，它的 VapourSynth 版本是：<a target="_blank" rel="noopener" href="https://github.com/HomeOfVapourSynthEvolution/xy-VSFilter%E3%80%82%E7%9B%AE%E5%89%8D%E5%8C%85%E6%8B%AC%E5%8E%9F%E7%89%88%E5%92%8C">https://github.com/HomeOfVapourSynthEvolution/xy-VSFilter。目前包括原版和</a> VapourSynth 版都不再有人维护，但是不影响我们继续使用。</p>
<p>使用方法为：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>xyvsf<span class="token punctuation">.</span>TextSub<span class="token punctuation">(</span>clip clip<span class="token punctuation">,</span> string <span class="token builtin">file</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token builtin">int</span> charset<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">float</span> fps<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> string vfr<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>有些字幕会用到复杂特效，需要  <code>VSFilterMod</code> ：<a target="_blank" rel="noopener" href="https://github.com/sorayuki/VSFilterMod%E3%80%82">https://github.com/sorayuki/VSFilterMod。</a></p>
<p>这个 VSFilterMod 也可以给播放器使用，但是注意只有少量特效能实时播放。因此你和字幕组合作时，得提前问清有没有需要 VSFilterMod 的特效，如果有，请他们尽量在外挂字幕中去除。一些可以实时播放并且不影响其他字幕滤镜渲染的特效，则可以保留，但是注意在发布时提醒观众。</p>
<p>一些主攻 Live 的字幕组，可能会大量使用无法实时播放的特效，这时可以选择制作两个版本：无字幕视频 + 外挂去特效字幕，内嵌特效字幕视频。</p>
<p>使用方法为：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>vsfm<span class="token punctuation">.</span>TextSubMod<span class="token punctuation">(</span>clip clip<span class="token punctuation">,</span> string <span class="token builtin">file</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token builtin">int</span> charset<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">float</span> fps<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> string vfr<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token builtin">int</span> accurate<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="2-libass系字幕滤镜"><a class="anchor" href="#2-libass系字幕滤镜">#</a> (2). libass 系字幕滤镜</h3>
<p>libass 系字幕滤镜没得选，只有  <code>assrender</code> ：<a target="_blank" rel="noopener" href="https://github.com/AmusementClub/assrender%E3%80%82">https://github.com/AmusementClub/assrender。</a></p>
<p>使用方法为：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>assrender<span class="token punctuation">.</span>TextSub<span class="token punctuation">(</span>clip clip<span class="token punctuation">,</span> string <span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>string vfr<span class="token punctuation">,</span> <span class="token builtin">int</span> hinting<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">float</span> scale<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token builtin">float</span> line_spacing<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token builtin">float</span> dar<span class="token punctuation">,</span> <span class="token builtin">float</span> sar<span class="token punctuation">,</span> <span class="token builtin">bool</span> set_default_storage_size<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">int</span> top<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">int</span> bottom<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">int</span> left<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">int</span> right<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> string charset<span class="token punctuation">,</span> <span class="token builtin">int</span> debuglevel<span class="token punctuation">,</span> string fontdir<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> string srt_font<span class="token operator">=</span><span class="token string">"sans-serif"</span><span class="token punctuation">,</span> string colorspace<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>顺带一提，assrender 可以设置  <code>fontdir</code>  参数，从指定目录获取字体，而 VSF 必须安装字体才能渲染。</p>
<div class="tags"><a href="/tags/%E8%A7%86%E9%A2%91%E5%8E%8B%E5%88%B6%E6%8A%80%E6%9C%AF%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" rel="tag"><i class="ic i-tag"></i>视频压制技术系列教程</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/2024/03/16/vcbstudio/第六章VS基础滤镜/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-03-16 23:09:52" itemprop="dateModified" datetime="2024-03-16T23:09:52+08:00">2024-03-16</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/bitcoin.png" alt="Sakura 比特币"/><p>比特币</p></div><div><img loading="lazy" data-src="/assets/monero.png" alt="Sakura monero"/><p>monero</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Sakura<i class="ic i-at"><em>@</em></i>Sakura</li><li class="link"><strong>本文链接：</strong><a href="https://sakurame.eu.org/2024/03/16/vcbstudio/%E7%AC%AC%E5%85%AD%E7%AB%A0VS%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C/" title="第六章VS基础滤镜">https://sakurame.eu.org/2024/03/16/vcbstudio/第六章VS基础滤镜/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%BA%94%E7%AB%A0VapourSynth%E5%9F%BA%E7%A1%80/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;ptpimg.me&#x2F;5515ea.jpg" title="第五章VapourSynth基础"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>视频压制技术</span><h3>第五章VapourSynth基础</h3></a></div><div class="item right"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%83%E7%AB%A0%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81%E5%99%A8%E5%9F%BA%E7%A1%80/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;ptpimg.me&#x2F;v5k41w.jpg" title="第七章视频编码器基础"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>视频压制技术</span><h3>第七章视频编码器基础</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-vs%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C"><span class="toc-number">1.</span> <span class="toc-text"> 第六章 VS 基础滤镜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%BA%90%E6%BB%A4%E9%95%9C"><span class="toc-number">1.1.</span> <span class="toc-text"> 1. 源滤镜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-lsmas"><span class="toc-number">1.1.1.</span> <span class="toc-text"> (1). lsmas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ffms2"><span class="toc-number">1.1.2.</span> <span class="toc-text"> (2). ffms2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-imwri"><span class="toc-number">1.1.3.</span> <span class="toc-text"> (3). imwri</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80%E8%A7%86%E9%A2%91%E6%93%8D%E4%BD%9C%E6%BB%A4%E9%95%9C"><span class="toc-number">1.2.</span> <span class="toc-text"> 2. 基础视频操作滤镜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-trim-splice"><span class="toc-number">1.2.1.</span> <span class="toc-text"> (1). Trim &#x2F; Splice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-interleave-selectevery"><span class="toc-number">1.2.2.</span> <span class="toc-text"> (2). Interleave &#x2F; SelectEvery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-crop-addborders"><span class="toc-number">1.2.3.</span> <span class="toc-text"> (3). Crop &#x2F; AddBorders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-shuffleplanes-splitplanes"><span class="toc-number">1.2.4.</span> <span class="toc-text"> (4). ShufflePlanes &#x2F; SplitPlanes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%B2%BE%E5%BA%A6%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text"> 3. 精度转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%AB%98%E7%B2%BE%E5%BA%A6%E4%B8%8Erange"><span class="toc-number">1.3.1.</span> <span class="toc-text"> (1). 高精度与 Range</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#range"><span class="toc-number">1.3.1.1.</span> <span class="toc-text"> Range</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vs%E7%B2%BE%E5%BA%A6%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.3.1.2.</span> <span class="toc-text"> VS 精度转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vs%E4%B8%AD%E7%9A%84format%E8%A1%A8%E7%A4%BA"><span class="toc-number">1.3.1.3.</span> <span class="toc-text"> VS 中的 format 表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#yuv-overflow-underflow"><span class="toc-number">1.3.1.4.</span> <span class="toc-text"> YUV overflow &#x2F; underflow</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%99%8D%E7%B2%BE%E5%BA%A6%E4%B8%8Edither"><span class="toc-number">1.3.2.</span> <span class="toc-text"> (2). 降精度与 Dither</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%88%9D%E7%AD%89resizer"><span class="toc-number">1.4.</span> <span class="toc-text"> 4. 初等 Resizer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-resizer%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text"> (1). resizer 的副作用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8Ablurring"><span class="toc-number">1.4.1.1.</span> <span class="toc-text"> 模糊（blurring）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%AF%E9%BD%BFaliasing"><span class="toc-number">1.4.1.2.</span> <span class="toc-text"> 锯齿（aliasing）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%AF%E9%93%83ringing"><span class="toc-number">1.4.1.3.</span> <span class="toc-text"> 振铃（ringing）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9B%BE%E5%83%8F%E7%9A%84%E7%BC%A9%E6%94%BE"><span class="toc-number">1.4.2.</span> <span class="toc-text"> (2). 图像的缩放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-resizer%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.3.</span> <span class="toc-text"> (3). resizer 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pointnearest"><span class="toc-number">1.4.3.1.</span> <span class="toc-text"> Point(Nearest)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bilinear"><span class="toc-number">1.4.3.2.</span> <span class="toc-text"> Bilinear</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bicubic"><span class="toc-number">1.4.3.3.</span> <span class="toc-text"> Bicubic</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spline"><span class="toc-number">1.4.3.4.</span> <span class="toc-text"> Spline</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lanczos"><span class="toc-number">1.4.3.5.</span> <span class="toc-text"> Lanczos</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gauss"><span class="toc-number">1.4.3.6.</span> <span class="toc-text"> Gauss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nnedi3"><span class="toc-number">1.4.3.7.</span> <span class="toc-text"> nnedi3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AD%97%E5%B9%95%E6%BB%A4%E9%95%9C"><span class="toc-number">1.5.</span> <span class="toc-text"> 5. 字幕滤镜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-vsf%E7%B3%BB%E5%AD%97%E5%B9%95%E6%BB%A4%E9%95%9C"><span class="toc-number">1.5.1.</span> <span class="toc-text"> (1). VSF 系字幕滤镜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-libass%E7%B3%BB%E5%AD%97%E5%B9%95%E6%BB%A4%E9%95%9C"><span class="toc-number">1.5.2.</span> <span class="toc-text"> (2). libass 系字幕滤镜</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/2023/05/17/vcbstudio/%E5%BC%80%E6%BA%90%E4%B8%80%E4%B8%8B%E5%BD%93%E5%88%9D%E5%8E%8B%E5%88%B6%E7%BB%84%E5%85%A5%E7%BB%84%E8%80%83%E8%AF%95%E7%9A%84%E7%AD%94%E5%8D%B7/" rel="bookmark" title="开源一下当初压制组入组考试的答卷">开源一下当初压制组入组考试的答卷</a></li><li ><a href="/2023/05/18/vcbstudio/%E5%BC%80%E6%BA%90%E4%B8%80%E4%B8%8B%E5%8E%8B%E5%88%B6%E7%BB%84%E8%80%83%E8%AF%95%E7%9A%84%E8%AF%95%E9%A2%98/" rel="bookmark" title="开源一下压制组考试的试题">开源一下压制组考试的试题</a></li><li ><a href="/2023/06/09/vcbstudio/%E7%86%9F%E6%82%89VapourSynth/" rel="bookmark" title="熟悉VapourSynth">熟悉VapourSynth</a></li><li ><a href="/2023/06/11/vcbstudio/%E7%A5%9E%E4%B8%80%E6%A0%B7%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%AC/" rel="bookmark" title="神一样的工具们">神一样的工具们</a></li><li ><a href="/2023/06/11/vcbstudio/%E8%AE%A4%E8%AF%86%E7%91%95%E7%96%B5/" rel="bookmark" title="认识瑕疵">认识瑕疵</a></li><li ><a href="/2023/06/11/vcbstudio/VapourSynth%E5%9F%BA%E7%A1%80/" rel="bookmark" title="VapourSynth基础">VapourSynth基础</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E8%AE%A4%E8%AF%86%E8%A7%86%E9%A2%91/" rel="bookmark" title="第一章从零开始认识视频">第一章从零开始认识视频</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%BA%8C%E7%AB%A0%E4%B8%80%E5%88%87%E7%9A%84%E8%B5%B7%E7%82%B9%E2%80%94%E2%80%94%E8%AE%A4%E8%AF%86BD/" rel="bookmark" title="第二章一切的起点——认识BD">第二章一切的起点——认识BD</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%89%E7%AB%A0%E7%A5%9E%E4%B8%80%E6%A0%B7%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%AC/" rel="bookmark" title="第三章神一样的工具们">第三章神一样的工具们</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%9B%9B%E7%AB%A0%E8%AE%A4%E8%AF%86%E7%91%95%E7%96%B5/" rel="bookmark" title="第四章认识瑕疵">第四章认识瑕疵</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%BA%94%E7%AB%A0VapourSynth%E5%9F%BA%E7%A1%80/" rel="bookmark" title="第五章VapourSynth基础">第五章VapourSynth基础</a></li><li  class="active"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%85%AD%E7%AB%A0VS%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C/" rel="bookmark" title="第六章VS基础滤镜">第六章VS基础滤镜</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%83%E7%AB%A0%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81%E5%99%A8%E5%9F%BA%E7%A1%80/" rel="bookmark" title="第七章视频编码器基础">第七章视频编码器基础</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%85%AB%E7%AB%A0VS%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86%E5%9F%BA%E7%A1%80/" rel="bookmark" title="第八章VS视频处理基础">第八章VS视频处理基础</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B9%9D%E7%AB%A0%E5%88%9D%E7%BA%A7%E8%A7%86%E9%A2%91%E7%91%95%E7%96%B5%E4%BF%AE%E5%A4%8D/" rel="bookmark" title="第九章初级视频瑕疵修复">第九章初级视频瑕疵修复</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%88%9D%E7%AD%8930fps%E5%A4%84%E7%90%86/" rel="bookmark" title="第十章初等30fps处理">第十章初等30fps处理</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0OKEGui%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="bookmark" title="第十一章OKEGui的使用">第十一章OKEGui的使用</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A08-bit%E4%BD%8E%E7%A0%81%E7%8E%87%E5%8E%8B%E5%88%B6/" rel="bookmark" title="第十二章8-bit低码率压制">第十二章8-bit低码率压制</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Sakura" src="/assets/avatar.jpg"/><p class="name" itemprop="name">Sakura</p><div class="description" itemprop="description">一个专注于技术和思考分享的博客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">76</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">25</span><span class="name">标签</span></a></div></nav><div class="social"><a href="mailto:mail@sakurame.eu.org" class="item email" title="mailto:mail@sakurame.eu.org"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>赞赏博主</a></li><li class="item"><a href="/privacy/" rel="section"><i class="ic i-user"></i>隐私政策</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-sakura"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%83%E7%AB%A0%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81%E5%99%A8%E5%9F%BA%E7%A1%80/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%BA%94%E7%AB%A0VapourSynth%E5%9F%BA%E7%A1%80/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/privacy/" title="分类于隐私保护指北">隐私保护指北</a></div><span><a href="/2023/04/24/privacy/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84UEFI%E4%BF%A1%E4%BB%BB%E9%93%BE/">从零开始构建自己的UEFI信任链</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="分类于游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/25/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/">games104系列笔记（一）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/basic-theory/" title="分类于计算机基础理论">计算机基础理论</a></div><span><a href="/2023/05/31/basic-theory/3D-TSV-The-3D-Trajectory-based-Stress-Visualizer/">3D-TSV_The_3D_Trajectory-based_Stress_Visualizer</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/thinking/" title="分类于思考随笔记录">思考随笔记录</a></div><span><a href="/2022/05/01/thinking/%E4%B8%80%E7%A7%8D%E5%B9%B3%E5%B8%B8%E7%9A%84%E7%94%9F%E6%B4%BB%E6%80%81%E5%BA%A6/">一种平常的生活态度</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="分类于游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/28/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89/">games104系列笔记（十一）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/privacy/" title="分类于隐私保护指北">隐私保护指北</a></div><span><a href="/2024/03/14/privacy/Canokey%E4%B8%8D%E5%AE%8C%E5%85%A8%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97-%E6%8C%81%E7%BB%AD%E8%B8%A9%E5%9D%91%E4%B8%AD/">Canokey不完全食用指南--持续踩坑中</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/thinking/" title="分类于思考随笔记录">思考随笔记录</a></div><span><a href="/2024/06/03/thinking/%E8%87%B4%E6%95%AC%E6%9D%BF%E7%A0%96%E7%BE%8E%E5%AD%A6/">致敬板砖美学之长寿板砖蓝天P775DM2笔记本电脑评测(转载自Bob's Coding Lab)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="分类于视频压制技术">视频压制技术</a></div><span><a href="/2023/06/11/vcbstudio/%E7%A5%9E%E4%B8%80%E6%A0%B7%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%AC/">神一样的工具们</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/basic-theory/" title="分类于计算机基础理论">计算机基础理论</a></div><span><a href="/2023/04/28/basic-theory/UNIX%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%EF%BC%9A%E9%80%9A%E4%BF%A1%EF%BC%8C%E5%B9%B6%E5%8F%91%E5%92%8C%E7%BA%BF%E7%A8%8B/">UNIX系统编程：通信，并发和线程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="分类于游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/28/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89/">games104系列笔记（十三）</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; Sun Apr 23 2023 08:00:00 GMT+0800 (中国标准时间) -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Sakura @ Sakura's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">1.6m 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">24:11</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div><br/><span style="display:inline;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:var(--grey-5);"><a target="_blank" href="https://icp.gov.moe/?keyword=20233555">萌ICP备20233555号 </a><br/><a target="_blank" href="https://beian.mps.gov.cn/#/query/webSearch?code=能躺在床上摸鱼摆烂是一天中最幸福的时刻"><img loading="lazy" decoding="async" data-src="/assets/search.png" style="max-width: 2em;display:inline;" width="20" height="20" alt="备案"/>能躺在床上摸鱼摆烂是一天中最幸福的时刻</a></span><div style="width: 100%;text-align:center;"><span id="time"></span></div><script>function createtime() {
    const n = new Date("2023/04/23 00:00:00");
    now.setTime(now.getTime() + 250), days = (now - n) / 1e3 / 60 / 60 / 24, dnum = Math.floor(days), hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum, hnum = Math.floor(hours), 1 == String(hnum).length && (hnum = "0" + hnum), minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum, mnum = Math.floor(minutes), 1 == String(mnum).length && (mnum = "0" + mnum), seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum, snum = Math.round(seconds), 1 == String(snum).length && (snum = "0" + snum), document.getElementById("time").innerHTML = "小破站已经在风雨飘摇中苟活" + dnum + " 天 " + hnum + " 小时 " + mnum + " 分 " + snum + " 秒"
}

const now = new Date;
setInterval("createtime()", 250)</script></div><div class="deng-box"><div class="deng"><div class="xian"></div><div class="deng-a"><div class="deng-b"><div class="deng-t">一</div></div></div><div class="shui shui-a"><div class="shui-c"></div><div class="shui-b"></div></div></div></div><div class="deng-box1"><div class="deng"><div class="xian"></div><div class="deng-a"><div class="deng-b"><div class="deng-t">十</div></div></div><div class="shui shui-a"><div class="shui-c"></div><div class="shui-b"></div></div></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2024/03/16/vcbstudio/第六章VS基础滤镜/`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?version=4.8.0&amp;features=default,fetch" defer></script><script src="/js/siteInit.js?v=0.4.11" type="module" fetchpriority="high" defer></script></body></html>