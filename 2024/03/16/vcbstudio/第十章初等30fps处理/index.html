<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="Sakura" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Sakura" type="application/atom+xml"><link rel="alternate" type="application/json" title="Sakura" href="https://sakurame.eu.org/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"/><link rel="dns-prefetch" href="https://unpkg.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.11"><link rel="modulepreload" href="/js/chunk-IUZCWEMQ.js"></link><link rel="modulepreload" href="/js/chunk-L5W3LNJ7.js"></link><link rel="modulepreload" href="/js/chunk-RR3NPWS6.js"></link><link rel="modulepreload" href="/js/chunk-T4SGHXZP.js"></link><link rel="modulepreload" href="/js/copy-tex-57F64HUY.js"></link><link rel="modulepreload" href="/js/index.esm-SW5I2P7Z.js"></link><link rel="modulepreload" href="/js/post-7WIGIAYE.js"></link><link rel="modulepreload" href="/js/quicklink-NZZC7HLM.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="modulepreload" href="/js/tcomments-GJZ3AF6Z.js"></link><link rel="preload" href="https://ptpimg.me/k444f5.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/60280z.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/k1yp55.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/ofuv6x.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/58864f.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/ysg110.jpg" as="image" fetchpriority="high"><meta name="keywords" content="视频压制技术系列教程"/><meta name="description" content="一个专注于技术和思考分享的博客"/><link rel="canonical" href="https://sakurame.eu.org/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%88%9D%E7%AD%8930fps%E5%A4%84%E7%90%86/"><title>第十章初等30fps处理</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">第十章初等30fps处理</h1><div class="meta"><span class="item" title="创建时间：2024-03-16 23:14:34"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2024-03-16T23:14:34+08:00">2024-03-16</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>19k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>17 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Sakura's Blog</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://ptpimg.me/k444f5.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/60280z.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/k1yp55.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/ofuv6x.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/58864f.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/ysg110.jpg&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/vcbstudio/" itemprop="item" rel="index" title="分类于视频压制技术"><span itemprop="name">视频压制技术<meta itemprop="position" content="0"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://sakurame.eu.org/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%88%9D%E7%AD%8930fps%E5%A4%84%E7%90%86/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="Sakura"/><meta itemprop="description" content=", 一个专注于技术和思考分享的博客"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sakura"/></span><div class="body md" itemprop="articleBody"><h1 id="第十章-初等-30-fps-处理"><a class="anchor" href="#第十章-初等-30-fps-处理">#</a> 第十章 初等 30 fps 处理</h1>
<h2 id="1-什么是隔行扫描"><a class="anchor" href="#1-什么是隔行扫描">#</a> 1. 什么是隔行扫描</h2>
<p>要解释这个概念，要先从电视广播制式说起，世界上最常见的两种便是 NTSC 和 PAL，这些标准的制定与使用一定程度上受不同地区的家用交流电频率影响。</p>
<ul>
<li>NTSC：1 秒 30 帧或 60 场，主要由家用交流电频率为 60 Hz 的北美与日本使用</li>
<li>PAL： 1 秒 25 帧或 50 场，主要由家用交流电频率为 50 Hz 的其他大部分国家地区使用，如大多数欧洲国家和中国</li>
</ul>
<p><em>由于我们主要说明的是日本动画等在日本播出的节目，所以下面如无特殊说明，介绍的均为 NTSC，两种制式的分别（如色彩）不再细说。</em></p>
<p>「场（field）」这个名词已经在前面的教程中出现过，而它正是因隔行扫描产生的概念。让我们回到 NTSC 制定的时代，那时的显示器大多使用的是 CRT（阴极射线管），它的显像原理简单来说就是电子束打到荧光粉来发亮，且受到了交流电频率的影响。<br />
为什么没有使用逐行扫描呢？这是因为显像用的荧光粉的亮度会衰减。逐行扫描是从左到右从上到下地逐步点亮，人眼看起来有闪烁感。所以先从上至下扫描奇数行组成一场，再从上至下扫描偶数行组成一场的方式，光暗交叉看起来要好上很多，1 秒内要显示的从 30 帧变为了 60 场，这种扫描方式便是隔行扫描（如下图所示）。随着技术的发展，CRT 也被 LCD  代替，现在已经很少见到，但隔行扫描的视频却仍然常见。</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/CRT_image_creation_animation-954ba38f564574dd19a970c32f15cb8b.gif" alt="img" /></p>
<p>我们将奇数场称之为上半场（Top Field），偶数场称之为下半场（Bottom  Field），显示上高度为正常帧高度的一半，即在同等带宽（无压缩）下，以空间分辨率（spatial  resolution）减半，换取时间分辨率（temporal resolution）加倍。虽然在展现上，上下半场可以合并为 1  帧，但扫描时间并不相同，时间差为  1/59.94s，所以在两场合并的帧上可能会出现交错条纹，或者说拉丝（如下图），也就是交错（Comb），这也是隔行扫描的典型特征。</p>
<p><em>注：请点开原图查看以获得正确的观看效果</em></p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/interlaced-bc8181396f07002579b9670ebb0287a0.jpg" alt="img" /></p>
<p><em>为什么 1 场是 1/59.94s 而不是 1/60s，这是因为在引入色彩时发生了 0.1% 的偏移，PAL 不存在这种现象。</em></p>
<p>由于历史影响，日本制作生产的大部分节目帧率还是 24/1.001、30/1.001、60/1.001，为了简化讨论我们依次称之为 24fps、30fps、60fps，24/1 称之为 24.00fps，依次类推。</p>
<h2 id="2-隔行扫描视频的种类"><a class="anchor" href="#2-隔行扫描视频的种类">#</a> 2. 隔行扫描视频的种类</h2>
<h3 id="1-样例"><a class="anchor" href="#1-样例">#</a> (1). 样例</h3>
<p>在 <a target="_blank" rel="noopener" href="https://github.com/vcb-s/guides/releases/tag/%2310">release</a> 的  <code>30fps_sample.7z</code>  中有 4 个不同的视频，可以下载后与下面对照查看。</p>
<p><em>如果使用 Vapoursynth 查看，可以先阅读下面的 隔行扫描视频的读取 - LWLibavSource 部分。</em></p>
<h4 id="sample1"><a class="anchor" href="#sample1">#</a> sample1</h4>
<p>其实是逐行扫描，偶尔看到的类似于交错的痕迹是缟缟，缟缟是对交错内容进行了错误处理导致的一种瑕疵。由于 Blu-ray 规范中只有 1920×1080 29.97i 而不允许 29.97p，所以在视频的信息标注上也是  29.97i，也就是伪装为隔行扫描视频的逐行扫描，一般我们称之为 30p。</p>
<h4 id="sample2"><a class="anchor" href="#sample2">#</a> sample2</h4>
<p>帧帧交错的隔行扫描，我们一般称之为 30i。</p>
<h4 id="sample3"><a class="anchor" href="#sample3">#</a> sample3</h4>
<p>大部分动画的帧率都是 24fps，但是会在帧率为 30fps 的电视广播中播出，在此中间便经过了一种名为 Telecine（胶卷过带）的处理，最常见的就是 3:2 pulldown（其实是 2:3 pulldown），具体做法如下图所示：</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/23pulldown-8255e5193cc25caefe9f3a8a8afe6462.png" alt="img" /></p>
<p>结果上看就是每 5 帧有 2 帧是交错的，即 PIIPP（3:2 pattern），又称作五烂二，每 3:2 个场的时间点相同，虽然仍避免不了卡顿但还算流畅。我们一般称之为 24t（24 telecine）。</p>
<h4 id="sample4"><a class="anchor" href="#sample4">#</a> sample4</h4>
<p>承接上文，还有一种 Telecine 的处理方式，就是每 4 帧重复 1 帧，这样 24fps 就转换为了 30fps。结果上看就是每 5 帧有 1  帧是重复的，每 2:2:2:4 / 1:1:1:2 个场的时间点相同，称之为 2:2:2:4 pulldown，这样的卡顿感比 24t  更甚，我们一般称之为 24d（24 duplicate）。</p>
<h3 id="2-总结"><a class="anchor" href="#2-总结">#</a> (2). 总结</h3>
<p>本节前文中的种类命名参考了 mawen1250 的 <a target="_blank" rel="noopener" href="https://www.nmm-hd.org/newbbs/viewtopic.php?f=7&amp;t=1367">ivtc_txt60mc 使用教程 - 对于 24t/24d+30i/30p 混合源的处理</a>，在学术上也许不严谨，但可以方便讨论。虽然有的未在样例中出现，但大概总结一下：</p>
<ul>
<li>24p：逐行扫描，每秒 24/1.001 帧，每帧无交错</li>
<li>60p：逐行扫描，每秒 60/1.001 帧，每帧无交错</li>
<li>60i：隔行扫描，每秒 60/1.001 场，每帧不一定有交错，下面提到的几种均为此种的细分类型</li>
<li>30p：每帧无交错，可能是 30/1.001 帧的逐行扫描，也可能是每帧无交错的 60i，本篇讨论的多为后者</li>
<li>30i：每帧都是交错的 60i</li>
<li>24t（24 telecine）：60i 中每 5 帧有 2 帧是交错的，即 PIIPP（3:2 pattern）</li>
<li>24d（24 duplicate）：60i 中每帧无交错，每秒 30/1.001 帧，但每 5 帧有 1 帧是重复的</li>
</ul>
<h2 id="3-24p-的视频是怎么播放的"><a class="anchor" href="#3-24p-的视频是怎么播放的">#</a> 3. 24p 的视频是怎么播放的</h2>
<p>标准的制定来自于实践，但反过来，标准也会影响产业链。</p>
<p>相信大家已经知道，常见的日本动画帧率便是受到 NTSC 影响的 24p（24/1.001）。可能不太清楚的是如今电影放映的基本标准也是  24p（24/1），这一标准的制定受到人体本身、放映技术等层面的影响，而且电影行业标准的制定要远早于电视广播制式的制定，感兴趣的人可以去自行搜索电影放映速度及行业标准的变化，此处便不再赘述。然而电影实际制作的时候，选用的可能也是 NTSC 的 24p（24/1.001）。</p>
<p>视频是要用来看的，可能是电视广播，也可能是借助于 DVD / Blu-ray 这种碟片载体，也可能是电脑上的文件。为了使 24p 的视频能在不同设备上播放，业界也有很多技术对其进行处理。大概有下面几种：</p>
<ol>
<li>将 24p 重编码为 24t / 24d 在 NTSC 设备上播放</li>
<li>将 24p 加速在 PAL 设备上播放</li>
<li>给 24p 的视频添加 pulldown flags，使 NTSC 设备在播放时进行转换</li>
<li>60Hz 显示器播放 24p 视频时，在每次屏幕刷新时重复显示视频的同一帧，直到下一帧的时间戳已经晚于屏幕刷新再显示下一帧，类似于 3:2 pulldown，这时出现的动态卡顿感也被称为 3:2 pulldown judder</li>
</ol>
<h3 id="1-soft-pulldown"><a class="anchor" href="#1-soft-pulldown">#</a> (1). soft pulldown</h3>
<p>第 1 种方式之前已经介绍过，我们着重说一下第 3 种方式，这种方式名为 soft telecine，又被称作 soft pulldown，与其相对应的重编码方法可以称作 hard telecine。</p>
<p>在视频的 24p 帧上添加一个 RFF（Repeat First Field）的 flag，播放设备在读取到这个 flag 的时候便会重复首场（TFF 时为顶场），一个正确的 repeat 如下表所示：</p>
<p><em>注：此处应按照 PTS 顺序</em></p>
<p><em>TFF flag = top_field_first; RFF flag = repeat_first_field</em></p>
<table>
<thead>
<tr>
<th>Source Frame</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>TFF flag</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>RFF flag</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Field</td>
<td>0t</td>
<td>0b</td>
<td>1t</td>
<td>1b</td>
<td>1t_r</td>
<td>2b</td>
<td>2t</td>
<td>3b</td>
<td>3t</td>
<td>3b_r</td>
</tr>
<tr>
<td>Present Frame</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>相较于 hard telecine，此种方法是无损的，而且可以节省传输的流量。由于 pulldown flag 可以只添加在视频流的一部分帧，所以真实的视频流帧率可能是变化的（vfr）而非恒定的（cfr）。</p>
<p><em>但是实际情况与标准不同，flag 错误、pulldown 错误都屡见不鲜，正确地分辨与处理就要仔细检查和积累经验。</em></p>
<h2 id="4-隔行扫描视频的读取"><a class="anchor" href="#4-隔行扫描视频的读取">#</a> 4. 隔行扫描视频的读取</h2>
<p>我们在处理隔行扫描视频之前，首先要先学会如何正确地读取。</p>
<h3 id="1-dgmpgdec"><a class="anchor" href="#1-dgmpgdec">#</a> (1). DGMPGDec</h3>
<p>首先先看一套有点「老」的软件 DGMPGDec，这是 Donald A. Graft 基于 DVD2AVI 开发的自由软件。可以从 <a target="_blank" rel="noopener" href="https://www.rationalqm.us/dgmpgdec/dgmpgdec.html">https://www.rationalqm.us/dgmpgdec/dgmpgdec.html</a> 获取源代码和相应配套组件。仅适用于 MPEG-1 和 MPEG-2，主要是后者，常见的大多是 DVD 和 Transport Stream。</p>
<p><em>以下基于 v2.0.0.8</em></p>
<p>包内对 vs 有用的只有 DGIndex 和 DGDecode，这里也只介绍我们可能会用到的 DGIndex 功能。</p>
<h4 id="dgindex"><a class="anchor" href="#dgindex">#</a> DGIndex</h4>
<p>DGIndex 有一个 gui，基本操作是  <code>File - Open (F2)</code> ，然后把需要加载的单个或多个文件  <code>ADD</code>  或拖拽上去，默认设置下  <code>File - Save Project (F4)</code>  会弹出 Information 窗口，显示结束后即可在源目录得到一个  <code>.d2v</code>  文件和 demux 的  <code>xxx DELAY xxxms.aac</code> 。</p>
<ul>
<li><code>.d2v</code>  中记录的源文件名是绝对路径</li>
<li>音频文件名上标注了需要 delay 的时间，mux 时可能会用到</li>
</ul>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/dg_00-e840bc3a822bc05070f64c0150eea00c.jpg" alt="img" /></p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/dg_01-638a88fc6d0f4e0cab53dee08573651f.jpg" alt="img" /></p>
<p>之所以会 demux 音轨是因为  <code>Audio - Output Method</code>  默认是  <code>Demux All Tracks</code> ，可以选择  <code>Disable</code>  不 demux 音轨（对应的是同目录配置文件  <code>DGIndex.ini</code>  中的  <code>Output_Method=0</code> ）。</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/dg_02-6fcea7d9a0c5989bca4ee5bf80f30a20.jpg" alt="img" /></p>
<p>还有一个可能用到的重要选项  <code>Video - Field Operation</code> ，它只对含有 pulldown flags 的视频有意义。</p>
<p>在介绍这个选项之前，需要先说明几个 DGMPGDec 中的概念：</p>
<ul>
<li>Film：相当于 24p，通常表现为 24t</li>
<li>NTSC Video：可略称为 Video，相当于 30p，通常表现为 30i、30p</li>
<li>Hybrid：film 与 video 的混合，可能是时间上的也可能是空间上的</li>
</ul>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/dg_03-900bb006ccac9cf0607dbf158000c991.jpg" alt="img" /></p>
<p>回到  <code>Field Operation</code> ：</p>
<ol>
<li>Honor Pulldown Flags (Default)：模拟播放设备对标有 RFF 的场进行 repeat，返回 30fps clip。</li>
<li>Ignore Pulldown Flags：忽略 RFF，返回原始 clip（会记录在 d2v 文件中但不会处理），24fps 的视频被标注为 30fps 的帧率。</li>
<li>Force Film：将 24d 转换为 24p 并返回。</li>
</ol>
<p>设置 Field Operation 的工作流程一般是这样的，先使用  <code>Honor Pulldown Flags</code> ，观察 Information 中的  <code>Video Type</code></p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/dg_04-a3ef7774c8dd881c4d3afd101d541fb8.jpg" alt="img" /></p>
<ol>
<li>如果显示 NTSC 或 PAL 说明没有 pulldown flags，应继续使用之前生成的 d2v</li>
<li>如果显示 Film 达到 95% 及以上（100% 也可被称为 Pure Film，此时无百分比显示）就可以使用  <code>Force Film</code>  得到 24p 的 clip，重新生成 d2v</li>
<li>如果显示 Film 低于 95% 或显示 Video，应继续使用之前生成的 d2v</li>
</ol>
<p>其实 DGIndex 也提供了 cli，示例：</p>
<pre><code>DGIndex.exe -i &quot;xx.ts&quot; -o &quot;xx&quot; -fo 0 -om 0
</code></pre>
<ul>
<li><code>-i</code> ：指定输入的文件路径</li>
<li><code>-o</code> ：指定输出的文件路径（包括文件名不包括文件扩展名）</li>
<li><code>-fo</code> ：Field Operation， 0、1、2 依次对应 Honor Pulldown Flags、Force Film、Ignore Pulldown Flags</li>
<li><code>-om</code> ：Output Method，0 - Disable、2 - Demux All Tracks</li>
</ul>
<h4 id="读取-d2v-文件"><a class="anchor" href="#读取-d2v-文件">#</a> 读取 d2v 文件</h4>
<p>d2v 文件类似于 lsmas 的 lwi，这也是一个纯文本文件，可以打开看下。</p>
<p><img loading="lazy" data-src="https://guides.vcb-s.com/assets/images/dg_05-4d65157bf25e0d2362f5d999919d2f94.jpg" alt="img" /></p>
<p>它记录的视频名是绝对路径，所以索引完就不要改变视频位置，要不然它会找不到。具体结构可以从  <code>DGIndexManual.html</code>  中看，不再说明，主要说下怎么从 Vapoursynth 中加载  <code>.d2v</code> ，有两种方法，一种是最近 port 的自带的  <code>dgdecode.MPEG2Source</code> ，另一种是  <code>d2v.Source</code> 。</p>
<p>DGIndex 的现代化替代品是 <a target="_blank" rel="noopener" href="https://github.com/dubhater/D2VWitch">D2VWitch</a>，与  <code>d2v.Source</code>  配套。</p>
<p>两个滤镜使用都很常规，指定 d2v 路径即可。只是对于 Force Film 生成的 d2v， <code>d2v.Source</code>  需要指定  <code>rff=False</code>  否则会得到一个帧率正确帧数错误的 clip。</p>
<p>如果你想使用  <code>dgdecode</code>  却不想把它放到默认加载的路径，可以使用  <code>LoadPlugin</code> ：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>LoadPlugin<span class="token punctuation">(</span><span class="token string">"DGDecode.dll"</span><span class="token punctuation">,</span> forcens<span class="token operator">=</span><span class="token string">"dgdecode"</span><span class="token punctuation">,</span> forceid<span class="token operator">=</span><span class="token string">"dgdecode"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>如果无法预览，可能是缺少 frameprops，可以使用  <code>std.SetFrameProps</code>  指定。d2vsource 则会添加需要的 frameprops 和 IPB 帧 type。</p>
<p><em>注： <code>dgdecode.MPEG2Source</code>  现在会在 clip 顶部与底部错误地各加 4px</em></p>
<h4 id="其他"><a class="anchor" href="#其他">#</a> 其他</h4>
<p>他还有一款与其类似的免费软件（原收费软件）<a target="_blank" rel="noopener" href="http://rationalqm.us/dgdecnv/dgdecnv.html">DGDecNV</a>，除 MPEG-2 外还支持 AVC、HEVC 等现代常用的编码格式。但仅支持 NVIDIA 显卡，且不太适合 MPEG-2 源的处理。</p>
<h3 id="2-lwlibavsource"><a class="anchor" href="#2-lwlibavsource">#</a> (2). LWLibavSource</h3>
<p>在实际流程中，我们用到 DGMPGDec 的时候有点少，一是 OKE 没有支持，二是只能读取 MPEG-2。一般使用的还是在基础滤镜篇章源滤镜部分提到的  LWLibavSource，DGMPGDec 更多时候是用于验证与比对。主要是对于 LWLibavSource 参数  <code>repeat</code>  的使用，其他与加载常规视频源相同。 <code>repeat</code>  只对含有 pulldown flags 的视频生效，也就是说如果视频中不含有 pulldown flags， <code>repeat</code>  的值无论为多少都会返回原本的视频。下面是不同  <code>repeat</code>  值对 soft pulldown 视频的处理。</p>
<ol>
<li>值为  <code>False</code>  或  <code>0</code>  时，不做任何处理，返回源视频，即
<ul>
<li>如果源是 24fps 和 30fps 混合返回帧率不明的 vfr clip</li>
<li>如果源全是 24fps（也就是 pure film）返回 24p clip（与 DGIndex 的  <code>Force Film</code>  行为相同），但帧率不一定正确，可能需要  <code>std.AssumeFPS(fpsnum=24000, fpsden=1001)</code></li>
</ul>
</li>
<li>其他值时，像播放器一样根据 pulldown flags 对需要重复的场进行 repeat，如果成功则返回一个 30fps 的 clip（与 DGIndex 的  <code>Honor Pulldown Flags</code>  行为相同，但结果更为可靠），如果失败：
<ul>
<li>若值为  <code>True</code>  或  <code>1</code> ，显式报错</li>
<li>若值为  <code>2</code> ，与  <code>0</code>  时相同，返回帧率不明的 vfr clip</li>
</ul>
</li>
</ol>
<p>pulldown flags 处理失败，可能是因为视频流破损、后期剪辑失误、超出 lsmas 处理能力等。<br />
对于返回的 vfr clip 也需要仔细检查，看起来正常但不一定正确。<br />
而且哪怕是  <code>repeat=1</code>  成功返回了 cfr clip，也要仔细检查帧顺序是否正确，如果出现问题可以从 <a target="_blank" rel="noopener" href="https://github.com/AkarinVS/L-SMASH-Works/issues">Github repo issues</a> 回报。</p>
<p>在启用  <code>repeat</code>  时可以通过 frameprops  <code>_EncodedFrameBottom</code>  和  <code>_EncodedFrameTop</code>  来查看当前帧由哪两场组成。同时  <code>.lwi</code>  文件中也记录了 rff 的信息， <code>Repeat=1</code>  为无 rff， <code>Repeat=2</code>  为 rff。</p>
<p>总之，处理中一般应使用更为严格安全的  <code>repeat=1</code> （默认值），repeat 失败再使用  <code>repeat=0</code> 。如果是查看老一些的脚本或使用旧版本的滤镜（vA.2 之前版本）时，你可能会发现  <code>repeat</code>  只有 True 与 False 两种，旧有的 True 就是现在的  <code>repeat=2</code> 。再老一些， <code>repeat</code>  默认是 false，现在  <code>repeat</code>  默认是 1…</p>
<h4 id="检测是否为全程-soft-pulldownpure-film"><a class="anchor" href="#检测是否为全程-soft-pulldownpure-film">#</a> 检测是否为全程 soft pulldown（pure film）</h4>
<p>可以使用 DGIndex，也可以用以下方法。</p>
<p>假设 repeat = 1 / 2 / True 时，读取到的视频帧数为 x，repeat = 0 / False 时读取到的视频帧数为 y，如果符合  <code>| 0.8 * x – y| &lt; 1</code>  则可以认为源视频是全程 soft pulldown，可以使用  <code>repeat=0</code>  得到 24p 的视频进行后处理，否则必须要开启  <code>repeat=1</code> 。~~ 当然就算是完美的 soft pulldown，开启  <code>repeat=1</code>  读取后再进行 IVTC 也没有问题。~~ 示例脚本：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> vapoursynth <span class="token keyword">as</span> vs</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> vapoursynth <span class="token keyword">import</span> core</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>source_file <span class="token operator">=</span> <span class="token string">"a.ts"</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">isSoftPulldown</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> vs<span class="token punctuation">.</span>VideoNode<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    a <span class="token operator">=</span> core<span class="token punctuation">.</span>lsmas<span class="token punctuation">.</span>LWLibavSource<span class="token punctuation">(</span>source_file<span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    b <span class="token operator">=</span> core<span class="token punctuation">.</span>lsmas<span class="token punctuation">.</span>LWLibavSource<span class="token punctuation">(</span>source_file<span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">if</span> debug<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">return</span> b</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> a <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>num_frames <span class="token operator">*</span> <span class="token number">0.8</span> <span class="token operator">-</span> a<span class="token punctuation">.</span>num_frames<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token keyword">else</span> b</pre></td></tr></table></figure><h2 id="5-隔行扫描视频的常规处理"><a class="anchor" href="#5-隔行扫描视频的常规处理">#</a> 5. 隔行扫描视频的常规处理</h2>
<p>正常情况下，我们要将隔行扫描视频正确地处理回逐行视频再进行后续的处理，下面就说下如何处理，顺序还是依照上面 sample 的顺序。</p>
<h3 id="1-指定-fieldbased30p"><a class="anchor" href="#1-指定-fieldbased30p">#</a> (1). 指定 FieldBased（30p）</h3>
<p>因为只是标记为 60i，视频本身仍为逐行扫描，所以只需要使用  <code>core.std.SetFieldBased(src, 0)</code>  将 Frameprops 中的  <code>_FieldBased</code>  标记为 0（Progressive）即可，通常在将隔行扫描的视频处理为逐行扫描的视频后都要如此操作，因为这样可以避免后续处理的滤镜读取到错误的 Frameprops 进行了错误的处理。</p>
<p>缟缟的处理放到后面。</p>
<h3 id="2-deint30i"><a class="anchor" href="#2-deint30i">#</a> (2). deint（30i）</h3>
<p>需要对源视频进行「反交错（deinterlace /deint）」。一些常见的 deint 滤镜有：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/AmusementClub/VapourSynth-EEDI2">EEDI2</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/AmusementClub/VapourSynth-EEDI3">EEDI3mod</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sekrit-twc/znedi3">znedi3</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/HomeOfVapourSynthEvolution/VapourSynth-TDeintMod">TDeintMod</a></li>
</ul>
<p>最简单的便是半场反交错，如  <code>core.znedi3.nnedi3(src, field=1)</code> ，直接扔掉下半场，只用上半场插补出整帧，这样帧率保持不变，变为场率的一半。但这种直接没了一半信息的做法实在过于粗暴，所以我们可以先进行分场，再对每场进行插补，如下所示：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>field_clip <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>SeparateFields<span class="token punctuation">(</span>src<span class="token punctuation">,</span> tff<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>res <span class="token operator">=</span> core<span class="token punctuation">.</span>znedi3<span class="token punctuation">.</span>nnedi3<span class="token punctuation">(</span>field_clip<span class="token punctuation">,</span> field<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> dh<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>现在帧率与场率相同了，但由于上下半场基线本就不同，所以必然会上下抖动。对此我们可以使用 havsfunc 中的一个 function QTGMC，它的原型是 TempGaussMC，是进行了时域的运动补偿，详细内容会在后面篇章说明。我们先简单使用一下它：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> vapoursynth <span class="token keyword">import</span> core</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> havsfunc <span class="token keyword">as</span> haf</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>src <span class="token operator">=</span> core<span class="token punctuation">.</span>lsmas<span class="token punctuation">.</span>LWLibavSource<span class="token punctuation">(</span>source_file<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>res <span class="token operator">=</span> haf<span class="token punctuation">.</span>QTGMC<span class="token punctuation">(</span>src<span class="token punctuation">,</span> TFF<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> Preset<span class="token operator">=</span><span class="token string">"Slower"</span><span class="token punctuation">,</span> FPSDivisor<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>res<span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>Preset</code>  是速度和质量相关的预设； <code>FPSDivisor=2</code>  会在全部处理后抽出奇数帧输出，最终结果为 30p，某种意义上可以减少编码帧数，加快编码速度和降低码率。</p>
<p>通常保持帧率不变的处理成为 deint，帧率翻倍的处理为 bob。</p>
<h3 id="3-ivtc24t-与-24d"><a class="anchor" href="#3-ivtc24t-与-24d">#</a> (3). ivtc（24t 与 24d）</h3>
<p>3:2 pulldown 上文已经说过，24t  的场排序为（1 上，1 下）、（2 上，2 下）、（2 上，3 下）、（3 上，4 下）、（4 上，4 下）。要想将其还原回 24p，就需要先进行场匹配（Frame Match）转换为  24d，即固定上半场不变，按规则与相邻帧的下半场进行组合，选择成品画面中拉丝最少的作为最终结果，变成了（1 上，1 下）、（2 上，2 下）、（2 上，2 下）、（3 上，3 下）、（4 上，4 下），最后以 5 帧为循环抽取并删除重复的一帧，转换为 24p。这套流程就叫做 IVTC（inverse telecine），一些常见的 IVTC 滤镜有：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/dubhater/vapoursynth-tivtc">TIVTC</a>：tritical 开发的一款 Avisynth 滤镜，后来由 dubhater 于 2021 年移植到 Vapoursynth</li>
<li>VIVTC：VS 内置滤镜之一，是由 VS 开发者当年重写的 TIVTC，相比少了一些功能，同样参数的效果也会有一些不同</li>
<li>a60224：Avisynth 滤镜，目前没有 VS 移植</li>
<li><a target="_blank" rel="noopener" href="https://github.com/HomeOfVapourSynthEvolution/VapourSynth-IT">IT</a></li>
</ul>
<p>在这先简单介绍下 vivtc，tivtc 的参数可以自行查阅 <a target="_blank" rel="noopener" href="http://avisynth.nl/index.php/TIVTC">Avisynth 的文档</a>。</p>
<ol>
<li>
<p>场匹配（vfm）</p>
<p><code>matched = core.vivtc.VFM(src, mode=1)</code></p>
<ul>
<li>vfm 只支持 8-bit 输入</li>
<li>mode：决定场匹配的方式和强度，范围 0-5。<br />
强度随数字变大逐步增大，越小越安全，但可能匹配不上，开大了也有可能会匹配错误</li>
</ul>
</li>
<li>
<p>删除重复帧（vdecimate）</p>
<p><code>res = core.vivtc.VDecimate(matched)</code></p>
<ul>
<li>vdecimate 支持 8-16 bit 输入</li>
</ul>
</li>
<li>
<p>后处理</p>
<p>场匹配不可能完美，但 vfm 会给无法匹配的帧添加  <code>_Combed=1</code>  的 frameprop，于是可以自己做 deint 来处理这些帧</p>
</li>
</ol>
<p>以下为一种简单的处理方式：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> vapoursynth <span class="token keyword">as</span> vs</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> vapoursynth <span class="token keyword">import</span> core</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> havsfunc <span class="token keyword">as</span> haf</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> functools</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">pp</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> f<span class="token punctuation">,</span> clip<span class="token punctuation">,</span> deinterlaced<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token keyword">if</span> f<span class="token punctuation">.</span>props<span class="token punctuation">[</span><span class="token string">'_Combed'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token keyword">return</span> deinterlaced</pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token keyword">return</span> clip</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>src <span class="token operator">=</span> core<span class="token punctuation">.</span>lsmas<span class="token punctuation">.</span>LWLibavSource<span class="token punctuation">(</span>source_file<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>matched <span class="token operator">=</span> core<span class="token punctuation">.</span>vivtc<span class="token punctuation">.</span>VFM<span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>deint <span class="token operator">=</span> haf<span class="token punctuation">.</span>QTGMC<span class="token punctuation">(</span>matched<span class="token punctuation">,</span> TFF<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> FPSDivisor<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>pp_clip <span class="token operator">=</span> core<span class="token punctuation">.</span>std<span class="token punctuation">.</span>FrameEval<span class="token punctuation">(</span>matched<span class="token punctuation">,</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>pp<span class="token punctuation">,</span> clip<span class="token operator">=</span>matched<span class="token punctuation">,</span> deinterlaced<span class="token operator">=</span>deint<span class="token punctuation">)</span><span class="token punctuation">,</span> prop_src<span class="token operator">=</span>matched<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>res <span class="token operator">=</span> core<span class="token punctuation">.</span>vivtc<span class="token punctuation">.</span>VDecimate<span class="token punctuation">(</span>pp_clip<span class="token punctuation">)</span></pre></td></tr></table></figure><p>24d 就是从第 2 步开始，不再赘述。</p>
<h3 id="4-vfr"><a class="anchor" href="#4-vfr">#</a> (4). vfr</h3>
<p>如前文 soft pulldown 部分所说，实际视频流中的 fps 不一定是恒定的，可能是时间上的多种类型的混合。也就是看起来是 60i  的视频，其中可能是 24d、30i、30p、24d  按时间的混合，这种时候应该对不同类型进行分别处理，最后再合并起来得到一个可变帧率（vfr）的视频。</p>
<h4 id="timecode"><a class="anchor" href="#timecode">#</a> timecode</h4>
<p>之前介绍过，播放端通过读取视频容器内的 timestamp 来渲染帧，而 timecode 文件正是一种封装在容器中记录帧时间的文本文件，常见的格式有 v1、v2 两种。v1 只是简单记录每个帧数区间的帧率，v2 则会详细记录每一帧的时间戳。</p>
<p>皆是以 0 帧作为起始帧，空格会被忽略。</p>
<h5 id="timecode-v1"><a class="anchor" href="#timecode-v1">#</a> timecode v1</h5>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre># timecode format v1</pre></td></tr><tr><td data-num="2"></td><td><pre>assume 25</pre></td></tr><tr><td data-num="3"></td><td><pre>800,1000,23.97</pre></td></tr><tr><td data-num="4"></td><td><pre>1500,1700,29.970</pre></td></tr></table></figure><ul>
<li>首行记录格式版本</li>
<li>次行记录未指定范围的帧率，帧率为浮点数</li>
<li>依次记录起止两端闭合区间及帧率</li>
</ul>
<p>这种格式更易于人类书写与查看。</p>
<h5 id="timecode-v2"><a class="anchor" href="#timecode-v2">#</a> timecode v2</h5>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre># timestamp format v2</pre></td></tr><tr><td data-num="2"></td><td><pre>0</pre></td></tr><tr><td data-num="3"></td><td><pre>40</pre></td></tr><tr><td data-num="4"></td><td><pre>80</pre></td></tr></table></figure><ul>
<li>首行记录格式版本</li>
<li>各行依次是顺序各帧的时间戳，时间戳精度为毫秒，浮点数</li>
</ul>
<h4 id="vs-生成-timecode-文件"><a class="anchor" href="#vs-生成-timecode-文件">#</a> vs 生成 timecode 文件</h4>
<p>示例： <code>res = mvsfunc.VFRSplice([30i_clip, 30p_clip, 24t_clip], tcfile=&quot;foobar.tcfile&quot;, v2=True)</code></p>
<ul>
<li>第一个参数是做完了 ivtc、deint 等的 clip 按照顺序组成的 list</li>
<li>tcfile 指定生成的 tcfile 的输出路径</li>
<li>v2 输入布尔值，决定输出的 tcfile 是 v1 还是 v2</li>
</ul>
<p>最后得到一个由 list 里的 clip 连接起来的 vfr clip 和一个 timecode file。</p>
<h4 id="怎样预览和输出-vfr"><a class="anchor" href="#怎样预览和输出-vfr">#</a> 怎样预览和输出 vfr</h4>
<p>上节我们得到了一个 vfr clip 和一个 tcfile。</p>
<h5 id="使用-vs-预览-vfr"><a class="anchor" href="#使用-vs-预览-vfr">#</a> 使用 VS 预览 vfr</h5>
<p>先用 vseditor 来预览一下这个 vfr clip，可以发现标注的 fps 为  <code>0/0</code> 。再换成 vspreview 预览，发现会弹出报错，因为 vspreview 无法处理 fps 为 0 的情况，那可以在 vfr clip 后追加一个  <code>AssumeFPS</code>  再  <code>set_output</code> 。如下示例：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># …</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>vfr_clip <span class="token operator">=</span> mvsfunc<span class="token punctuation">.</span>VFRSplice<span class="token punctuation">(</span><span class="token punctuation">[</span>clip1<span class="token punctuation">,</span> clip2<span class="token punctuation">]</span><span class="token punctuation">,</span> tcfile<span class="token operator">=</span><span class="token string">"foobar.tcfile"</span><span class="token punctuation">,</span> v2<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># simple</span></pre></td></tr><tr><td data-num="6"></td><td><pre>res1 <span class="token operator">=</span> vfr_clip<span class="token punctuation">.</span>std<span class="token punctuation">.</span>AssumeFPS<span class="token punctuation">(</span>fpsnum<span class="token operator">=</span><span class="token number">30000</span><span class="token punctuation">,</span> fpsden<span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># safe</span></pre></td></tr><tr><td data-num="9"></td><td><pre>res2 <span class="token operator">=</span> vfr_clip<span class="token punctuation">.</span>std<span class="token punctuation">.</span>AssumeFPS<span class="token punctuation">(</span>fpsnum<span class="token operator">=</span><span class="token punctuation">(</span>clip1<span class="token punctuation">.</span>num_frames <span class="token operator">+</span> clip2<span class="token punctuation">.</span>num_frames<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">,</span> fpsden<span class="token operator">=</span><span class="token punctuation">(</span>clip1<span class="token punctuation">.</span>num_frames<span class="token operator">/</span>clip1<span class="token punctuation">.</span>fps<span class="token operator">+</span>clip2<span class="token punctuation">.</span>num_frames<span class="token operator">/</span>clip2<span class="token punctuation">.</span>fps<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_output<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h5 id="从-vfr-视频中提取-timecode"><a class="anchor" href="#从-vfr-视频中提取-timecode">#</a> 从 vfr 视频中提取 timecode</h5>
<pre><code>ffms2.Source(timecodes=&quot;tcfile.txt&quot;)
</code></pre>
<h5 id="编码器编码-vfr"><a class="anchor" href="#编码器编码-vfr">#</a> 编码器编码 vfr</h5>
<ol>
<li>x264 可以直接使用参数指定  <code>--tcfile-in &quot;foobar.tcfile&quot;</code></li>
<li>x265 没有 vfr 支持，但可以输入输出 cfr 视频，再在封装时指定 timecode</li>
</ol>
<h5 id="封装-vfr"><a class="anchor" href="#封装-vfr">#</a> 封装 vfr</h5>
<ol>
<li>
<p>l-smash</p>
<ul>
<li>gui 可以直接指定 timecode file</li>
<li>cli 需要先按正常流程封装 mp4，再使用  <code>timelineeditor</code>  重新封装： <code>.\timelineeditor.exe --timecode &quot;foobar.tcfile&quot; cfr.mp4 vfr.mp4</code></li>
</ul>
</li>
<li>
<p>mkvmerge</p>
<p>看 doc</p>
</li>
<li>
<p>oke</p>
<p>在配置文件中，指定 TimeCode 项为 True，便会启用 vfr 输出，且不再检查 fps 信息，封装 mkv 时将输入文件同路径下的同名 tcfile 封装进去</p>
</li>
</ol>
<h2 id="6-被错误处理的隔行视频"><a class="anchor" href="#6-被错误处理的隔行视频">#</a> 6. 被错误处理的隔行视频</h2>
<h3 id="1-缟缟"><a class="anchor" href="#1-缟缟">#</a> (1). 缟缟</h3>
<p>重新打开 sample1，可以看到像下图一样有一些很像交错特征，实际上又不是的东西：</p>
<p><img loading="lazy" data-src="data:image/jpeg;base64,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" alt="img" /></p>
<p>简单的缟缟处理非常简单，使用  <code>havsfunc.daa()</code>  即可。</p>
<div class="tags"><a href="/tags/%E8%A7%86%E9%A2%91%E5%8E%8B%E5%88%B6%E6%8A%80%E6%9C%AF%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" rel="tag"><i class="ic i-tag"></i>视频压制技术系列教程</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/2024/03/16/vcbstudio/第十章初等30fps处理/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-03-16 23:15:20" itemprop="dateModified" datetime="2024-03-16T23:15:20+08:00">2024-03-16</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/bitcoin.png" alt="Sakura 比特币"/><p>比特币</p></div><div><img loading="lazy" data-src="/assets/monero.png" alt="Sakura monero"/><p>monero</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Sakura<i class="ic i-at"><em>@</em></i>Sakura</li><li class="link"><strong>本文链接：</strong><a href="https://sakurame.eu.org/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%88%9D%E7%AD%8930fps%E5%A4%84%E7%90%86/" title="第十章初等30fps处理">https://sakurame.eu.org/2024/03/16/vcbstudio/第十章初等30fps处理/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B9%9D%E7%AB%A0%E5%88%9D%E7%BA%A7%E8%A7%86%E9%A2%91%E7%91%95%E7%96%B5%E4%BF%AE%E5%A4%8D/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;ptpimg.me&#x2F;529px6.jpg" title="第九章初级视频瑕疵修复"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>视频压制技术</span><h3>第九章初级视频瑕疵修复</h3></a></div><div class="item right"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0OKEGui%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;ptpimg.me&#x2F;r129au.jpg" title="第十一章OKEGui的使用"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>视频压制技术</span><h3>第十一章OKEGui的使用</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0-%E5%88%9D%E7%AD%89-30-fps-%E5%A4%84%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text"> 第十章 初等 30 fps 处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E9%9A%94%E8%A1%8C%E6%89%AB%E6%8F%8F"><span class="toc-number">1.1.</span> <span class="toc-text"> 1. 什么是隔行扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%9A%94%E8%A1%8C%E6%89%AB%E6%8F%8F%E8%A7%86%E9%A2%91%E7%9A%84%E7%A7%8D%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text"> 2. 隔行扫描视频的种类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A0%B7%E4%BE%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text"> (1). 样例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sample1"><span class="toc-number">1.2.1.1.</span> <span class="toc-text"> sample1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sample2"><span class="toc-number">1.2.1.2.</span> <span class="toc-text"> sample2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sample3"><span class="toc-number">1.2.1.3.</span> <span class="toc-text"> sample3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sample4"><span class="toc-number">1.2.1.4.</span> <span class="toc-text"> sample4</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.2.</span> <span class="toc-text"> (2). 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-24p-%E7%9A%84%E8%A7%86%E9%A2%91%E6%98%AF%E6%80%8E%E4%B9%88%E6%92%AD%E6%94%BE%E7%9A%84"><span class="toc-number">1.3.</span> <span class="toc-text"> 3. 24p 的视频是怎么播放的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-soft-pulldown"><span class="toc-number">1.3.1.</span> <span class="toc-text"> (1). soft pulldown</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%9A%94%E8%A1%8C%E6%89%AB%E6%8F%8F%E8%A7%86%E9%A2%91%E7%9A%84%E8%AF%BB%E5%8F%96"><span class="toc-number">1.4.</span> <span class="toc-text"> 4. 隔行扫描视频的读取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-dgmpgdec"><span class="toc-number">1.4.1.</span> <span class="toc-text"> (1). DGMPGDec</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dgindex"><span class="toc-number">1.4.1.1.</span> <span class="toc-text"> DGIndex</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96-d2v-%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.2.</span> <span class="toc-text"> 读取 d2v 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.4.1.3.</span> <span class="toc-text"> 其他</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-lwlibavsource"><span class="toc-number">1.4.2.</span> <span class="toc-text"> (2). LWLibavSource</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E4%B8%BA%E5%85%A8%E7%A8%8B-soft-pulldownpure-film"><span class="toc-number">1.4.2.1.</span> <span class="toc-text"> 检测是否为全程 soft pulldown（pure film）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%9A%94%E8%A1%8C%E6%89%AB%E6%8F%8F%E8%A7%86%E9%A2%91%E7%9A%84%E5%B8%B8%E8%A7%84%E5%A4%84%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text"> 5. 隔行扫描视频的常规处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8C%87%E5%AE%9A-fieldbased30p"><span class="toc-number">1.5.1.</span> <span class="toc-text"> (1). 指定 FieldBased（30p）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-deint30i"><span class="toc-number">1.5.2.</span> <span class="toc-text"> (2). deint（30i）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-ivtc24t-%E4%B8%8E-24d"><span class="toc-number">1.5.3.</span> <span class="toc-text"> (3). ivtc（24t 与 24d）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-vfr"><span class="toc-number">1.5.4.</span> <span class="toc-text"> (4). vfr</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#timecode"><span class="toc-number">1.5.4.1.</span> <span class="toc-text"> timecode</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#timecode-v1"><span class="toc-number">1.5.4.1.1.</span> <span class="toc-text"> timecode v1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#timecode-v2"><span class="toc-number">1.5.4.1.2.</span> <span class="toc-text"> timecode v2</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vs-%E7%94%9F%E6%88%90-timecode-%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.4.2.</span> <span class="toc-text"> vs 生成 timecode 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E6%A0%B7%E9%A2%84%E8%A7%88%E5%92%8C%E8%BE%93%E5%87%BA-vfr"><span class="toc-number">1.5.4.3.</span> <span class="toc-text"> 怎样预览和输出 vfr</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-vs-%E9%A2%84%E8%A7%88-vfr"><span class="toc-number">1.5.4.3.1.</span> <span class="toc-text"> 使用 VS 预览 vfr</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E-vfr-%E8%A7%86%E9%A2%91%E4%B8%AD%E6%8F%90%E5%8F%96-timecode"><span class="toc-number">1.5.4.3.2.</span> <span class="toc-text"> 从 vfr 视频中提取 timecode</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%99%A8%E7%BC%96%E7%A0%81-vfr"><span class="toc-number">1.5.4.3.3.</span> <span class="toc-text"> 编码器编码 vfr</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%81%E8%A3%85-vfr"><span class="toc-number">1.5.4.3.4.</span> <span class="toc-text"> 封装 vfr</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%A2%AB%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%9A%84%E9%9A%94%E8%A1%8C%E8%A7%86%E9%A2%91"><span class="toc-number">1.6.</span> <span class="toc-text"> 6. 被错误处理的隔行视频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%9F%E7%BC%9F"><span class="toc-number">1.6.1.</span> <span class="toc-text"> (1). 缟缟</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/2023/05/17/vcbstudio/%E5%BC%80%E6%BA%90%E4%B8%80%E4%B8%8B%E5%BD%93%E5%88%9D%E5%8E%8B%E5%88%B6%E7%BB%84%E5%85%A5%E7%BB%84%E8%80%83%E8%AF%95%E7%9A%84%E7%AD%94%E5%8D%B7/" rel="bookmark" title="开源一下当初压制组入组考试的答卷">开源一下当初压制组入组考试的答卷</a></li><li ><a href="/2023/05/18/vcbstudio/%E5%BC%80%E6%BA%90%E4%B8%80%E4%B8%8B%E5%8E%8B%E5%88%B6%E7%BB%84%E8%80%83%E8%AF%95%E7%9A%84%E8%AF%95%E9%A2%98/" rel="bookmark" title="开源一下压制组考试的试题">开源一下压制组考试的试题</a></li><li ><a href="/2023/06/09/vcbstudio/%E7%86%9F%E6%82%89VapourSynth/" rel="bookmark" title="熟悉VapourSynth">熟悉VapourSynth</a></li><li ><a href="/2023/06/11/vcbstudio/%E7%A5%9E%E4%B8%80%E6%A0%B7%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%AC/" rel="bookmark" title="神一样的工具们">神一样的工具们</a></li><li ><a href="/2023/06/11/vcbstudio/%E8%AE%A4%E8%AF%86%E7%91%95%E7%96%B5/" rel="bookmark" title="认识瑕疵">认识瑕疵</a></li><li ><a href="/2023/06/11/vcbstudio/VapourSynth%E5%9F%BA%E7%A1%80/" rel="bookmark" title="VapourSynth基础">VapourSynth基础</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E8%AE%A4%E8%AF%86%E8%A7%86%E9%A2%91/" rel="bookmark" title="第一章从零开始认识视频">第一章从零开始认识视频</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%BA%8C%E7%AB%A0%E4%B8%80%E5%88%87%E7%9A%84%E8%B5%B7%E7%82%B9%E2%80%94%E2%80%94%E8%AE%A4%E8%AF%86BD/" rel="bookmark" title="第二章一切的起点——认识BD">第二章一切的起点——认识BD</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%89%E7%AB%A0%E7%A5%9E%E4%B8%80%E6%A0%B7%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%AC/" rel="bookmark" title="第三章神一样的工具们">第三章神一样的工具们</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%9B%9B%E7%AB%A0%E8%AE%A4%E8%AF%86%E7%91%95%E7%96%B5/" rel="bookmark" title="第四章认识瑕疵">第四章认识瑕疵</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%BA%94%E7%AB%A0VapourSynth%E5%9F%BA%E7%A1%80/" rel="bookmark" title="第五章VapourSynth基础">第五章VapourSynth基础</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%85%AD%E7%AB%A0VS%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C/" rel="bookmark" title="第六章VS基础滤镜">第六章VS基础滤镜</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%83%E7%AB%A0%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81%E5%99%A8%E5%9F%BA%E7%A1%80/" rel="bookmark" title="第七章视频编码器基础">第七章视频编码器基础</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%85%AB%E7%AB%A0VS%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86%E5%9F%BA%E7%A1%80/" rel="bookmark" title="第八章VS视频处理基础">第八章VS视频处理基础</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B9%9D%E7%AB%A0%E5%88%9D%E7%BA%A7%E8%A7%86%E9%A2%91%E7%91%95%E7%96%B5%E4%BF%AE%E5%A4%8D/" rel="bookmark" title="第九章初级视频瑕疵修复">第九章初级视频瑕疵修复</a></li><li  class="active"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%88%9D%E7%AD%8930fps%E5%A4%84%E7%90%86/" rel="bookmark" title="第十章初等30fps处理">第十章初等30fps处理</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0OKEGui%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="bookmark" title="第十一章OKEGui的使用">第十一章OKEGui的使用</a></li><li ><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A08-bit%E4%BD%8E%E7%A0%81%E7%8E%87%E5%8E%8B%E5%88%B6/" rel="bookmark" title="第十二章8-bit低码率压制">第十二章8-bit低码率压制</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Sakura" src="/assets/avatar.jpg"/><p class="name" itemprop="name">Sakura</p><div class="description" itemprop="description">一个专注于技术和思考分享的博客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">77</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">25</span><span class="name">标签</span></a></div></nav><div class="social"><a href="mailto:mail@sakurame.eu.org" class="item email" title="mailto:mail@sakurame.eu.org"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>赞赏博主</a></li><li class="item"><a href="/privacy/" rel="section"><i class="ic i-user"></i>隐私政策</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-sakura"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0OKEGui%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B9%9D%E7%AB%A0%E5%88%9D%E7%BA%A7%E8%A7%86%E9%A2%91%E7%91%95%E7%96%B5%E4%BF%AE%E5%A4%8D/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/basic-theory/" title="分类于计算机基础理论">计算机基础理论</a></div><span><a href="/2023/09/08/basic-theory/Water-Injection-Optimization-Using-Historical-Production-and-Seismic-Data/">Water_Injection_Optimization_Using_Historical_Production_and_Seismic_Data</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/thinking/" title="分类于思考随笔记录">思考随笔记录</a></div><span><a href="/2023/08/28/thinking/united-93%E4%B9%8B%E6%80%9D/">united_93之思</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="分类于视频压制技术">视频压制技术</a></div><span><a href="/2023/06/09/vcbstudio/%E7%86%9F%E6%82%89VapourSynth/">熟悉VapourSynth</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="分类于视频压制技术">视频压制技术</a></div><span><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%9B%9B%E7%AB%A0%E8%AE%A4%E8%AF%86%E7%91%95%E7%96%B5/">第四章认识瑕疵</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="分类于游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/28/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%E5%8D%81%EF%BC%89/">games104系列笔记（二十）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="分类于游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/25/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/">games104系列笔记（二）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="分类于视频压制技术">视频压制技术</a></div><span><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%BA%8C%E7%AB%A0%E4%B8%80%E5%88%87%E7%9A%84%E8%B5%B7%E7%82%B9%E2%80%94%E2%80%94%E8%AE%A4%E8%AF%86BD/">第二章一切的起点——认识BD</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/09/17/hello-world/">Hello World</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="分类于游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/28/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89/">games104系列笔记（十六）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/thinking/" title="分类于思考随笔记录">思考随笔记录</a></div><span><a href="/2024/06/03/thinking/%E8%87%B4%E6%95%AC%E6%9D%BF%E7%A0%96%E7%BE%8E%E5%AD%A6/">致敬板砖美学之长寿板砖蓝天P775DM2笔记本电脑评测(转载自Bob's Coding Lab)</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2023 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Sakura @ Sakura's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">1.6m 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">24:12</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div><br/><span style="display:inline;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:var(--grey-5);"><a target="_blank" href="https://icp.gov.moe/?keyword=20233555">萌ICP备20233555号 </a><br/><a target="_blank" href="https://beian.mps.gov.cn/#/query/webSearch?code=能躺在床上摸鱼摆烂是一天中最幸福的时刻"><img loading="lazy" decoding="async" data-src="/assets/search.png" style="max-width: 2em;display:inline;" width="20" height="20" alt="备案"/>能躺在床上摸鱼摆烂是一天中最幸福的时刻</a></span><div style="width: 100%;text-align:center;"><span id="time"></span></div><script>function createtime() {
    const n = new Date("2023/04/23 00:00:00");
    now.setTime(now.getTime() + 250), days = (now - n) / 1e3 / 60 / 60 / 24, dnum = Math.floor(days), hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum, hnum = Math.floor(hours), 1 == String(hnum).length && (hnum = "0" + hnum), minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum, mnum = Math.floor(minutes), 1 == String(mnum).length && (mnum = "0" + mnum), seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum, snum = Math.round(seconds), 1 == String(snum).length && (snum = "0" + snum), document.getElementById("time").innerHTML = "小破站已经在风雨飘摇中苟活" + dnum + " 天 " + hnum + " 小时 " + mnum + " 分 " + snum + " 秒"
}

const now = new Date;
setInterval("createtime()", 250)</script></div><div class="deng-box"><div class="deng"><div class="xian"></div><div class="deng-a"><div class="deng-b"><div class="deng-t">一</div></div></div><div class="shui shui-a"><div class="shui-c"></div><div class="shui-b"></div></div></div></div><div class="deng-box1"><div class="deng"><div class="xian"></div><div class="deng-a"><div class="deng-b"><div class="deng-t">十</div></div></div><div class="shui shui-a"><div class="shui-c"></div><div class="shui-b"></div></div></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2024/03/16/vcbstudio/第十章初等30fps处理/`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?version=4.8.0&amp;features=default,fetch" defer></script><script src="/js/siteInit.js?v=0.4.11" type="module" fetchpriority="high" defer></script></body></html>