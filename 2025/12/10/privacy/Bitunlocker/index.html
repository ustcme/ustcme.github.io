<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="alternate" href="/rss.xml" title="sakura" s="" blog""="" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="sakura" s="" blog""="" type="application/atom+xml"><link rel="alternate" type="application/json" title="sakura&quot;s blog&quot;" href="https://sakurame.eu.org/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext" media="none" onload="this.media='all'"><link rel="modulepreload" href="/js/siteInit.js"><link rel="modulepreload" href="/js/nyx-player-FL6IVJ7K.js"><link rel="modulepreload" href="/js/copy-tex-J4RXVQFU.js"><link rel="modulepreload" href="/js/post-BYOOLMPE.js"><link rel="modulepreload" href="/js/chunk-HOQ6CD2A.js"><link rel="modulepreload" href="/js/tcomments-MXX364JD.js"><link rel="modulepreload" href="/js/chunk-UAU5CDGP.js"><link rel="modulepreload" href="/js/index.esm-D6VTWJFS.js"><link rel="modulepreload" href="/js/chunk-LDEIN6IO.js"><link rel="modulepreload" href="/js/chunk-C2255TGX.js"><link rel="modulepreload" href="/js/cf-patch.js"><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media='all'"><script src="/js/cf-patch.js?v=0.5.4" type="module" fetchpriority="high" defer=""></script><link rel="preload" href="https://ptpimg.me/2m9g2v.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/1736wk.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/35h5vq.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/6gf16r.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/e8k2yf.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://ptpimg.me/355768.jpg" as="image" fetchpriority="high"><meta name="keywords" content="Security"><meta name="description" content="The spirit of independence and the freedom of thought "><link rel="canonical" href="https://sakurame.eu.org/2025/12/10/privacy/Bitunlocker/"><link rel="stylesheet" href="/css/post.css?v=0.5.4"><link rel="stylesheet" href="/css/mermaid.css?v=0.5.4"><!-- 临时处理--><link rel="stylesheet" media="none" onload="this.media='all'" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css"><title>BitUnlocker - Leveraging Windows Recovery to Extract BitLocker Secrets</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="pagefind_mount"></div><div id="container"><header id="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">BitUnlocker - Leveraging Windows Recovery to Extract BitLocker Secrets</h1><div class="meta"><span class="item" title="Created: 2025-12-10 22:35:08"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">Posted on</span><time itemprop="dateCreated datePublished" datetime="2025-12-10T22:35:08+08:00">2025-12-10</time></span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i></span><span class="text">Symbols count in article</span><span>38k</span><span class="text">words</span></span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i></span><span class="text">Reading time</span><span>34 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Sakura's Blog</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://ptpimg.me/2m9g2v.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/1736wk.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/35h5vq.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/6gf16r.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/e8k2yf.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://ptpimg.me/355768.jpg&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement="" itemscope="" itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">Home</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/privacy/" itemprop="item" rel="index" title="In隐私保护指北"><span itemprop="name">隐私保护指北<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" data-pagefind-body="data-pagefind-body" lang="zh-cn"><link itemprop="mainEntityOfPage" href="https://sakurame.eu.org/2025/12/10/privacy/Bitunlocker/"><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"><meta itemprop="name" content="AUVeggry"><meta itemprop="description" content=", The spirit of independence and the freedom of thought "></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="sakura&quot;s blog&quot;"></span><div class="body md" itemprop="articleBody"><h1 id="bitunlocker-leveraging-windows-recovery-to-extract-bitlocker-secrets"><a class="anchor" href="#bitunlocker-leveraging-windows-recovery-to-extract-bitlocker-secrets">#</a> BitUnlocker: Leveraging Windows Recovery to Extract BitLocker Secrets</h1>
<p><a target="_blank" rel="noopener" href="https://techcommunity.microsoft.com/users/alon-leviev/3118637"><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/dS0zMTE4NjM3LW91dHpXbw?image-coordinates=0%2C0%2C874%2C874&amp;image-dimensions=50x50" alt="alon-leviev's avatar"></a></p>
<p><a target="_blank" rel="noopener" href="https://techcommunity.microsoft.com/users/alon-leviev/3118637">alon-leviev</a></p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true" alt="Icon for Microsoft rank">Microsoft</p>
<p>Aug 14, 2025</p>
<h5 id="table-of-contents"><a class="anchor" href="#table-of-contents">#</a> <strong>Table of Contents</strong></h5>
<ol>
<li>Introduction</li>
<li>BitLocker Overview</li>
<li>WinRE Overview</li>
<li>Attacking Boot.sdi Parsing</li>
<li>Attacking ReAgent.xml Parsing</li>
<li>Attacking Boot Configuration Data (BCD) Parsing</li>
<li>Vulnerability Fixes</li>
<li>BitLocker Countermeasures</li>
<li>About the STORM Researchers</li>
</ol>
<h3 id="introduction"><a class="anchor" href="#introduction">#</a> <strong>Introduction</strong></h3>
<p>In Windows, the cornerstone of data protection is BitLocker, a Full Volume Encryption technology designed to secure sensitive data on disk. This ensures that even if an adversary gains physical access to the device, the data remains secure and inaccessible.</p>
<p>One of the most critical aspects of any data protection feature is its ability to support recovery operations in case of failure. To enable BitLocker recovery, significant design changes were implemented in the Windows Recovery Environment (WinRE). This led us to a pivotal question: did these changes introduce any new attack surfaces impacting BitLocker?</p>
<p>Our recent research project - first presented at Black Hat USA 2025 and DEF CON 33 (2025) – set out to explore the WinRE attack surfaces impacting BitLocker: finding new vulnerabilities, developing exploits, implementing fixes and ultimately hardening and further securing both WinRE and BitLocker. The research resulted in new vulnerabilities identified in WinRE and its boot procedure – most of which fall into the class of logical vulnerabilities.</p>
<p>In this blog post, we will share the research journey: we will begin with an overview of the WinRE architecture, followed by a retrospective analysis of the attack surfaces exposed with the introduction of BitLocker. We will then discuss our methodology for effectively researching and exploiting these exposed attack surfaces. We will reveal how we identified new vulnerabilities and developed exploits, enabling us to bypass BitLocker and extract the protected data.</p>
<p>To conclude this blog post, we will outline countermeasure that you can apply today to further harden BitLocker and highlight our commitment to continue our proactive and continues security work around WinRE, BitLocker and the related components.</p>
<h3 id="bitlocker-overview"><a class="anchor" href="#bitlocker-overview">#</a> <strong>BitLocker Overview</strong></h3>
<p>BitLocker is a Windows security feature that provides data-at-rest protection for disk volumes. BitLocker protection is based on Full Volume Encryption (FVE) technology that once enabled, encrypts the target volume, protecting all the data stored on it. Users have the flexibility to choose which volumes to encrypt based on their specific needs. By default, BitLocker targets the OS volume, ensuring that all data within the OS environment is protected.</p>
<p>Figure 1: Volume layout and BitLocker encryption</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWNUaDRJcQ?image-dimensions=915x303&amp;revision=8" alt="img"></p>
<h5 id="bitlocker-threat-model"><a class="anchor" href="#bitlocker-threat-model">#</a> <strong>BitLocker Threat Model</strong></h5>
<p>BitLocker aims to defend against theft scenarios, where a thief steals your laptop, aiming to extract your sensitive information, compromise your machine and even backdoor it. Consequently, the BitLocker threat model assumes an attacker like a common thief -</p>
<ol>
<li>Full physical access</li>
<li>No advanced credentials (usernames, passwords, etc.)</li>
</ol>
<p>BitLocker is one of the few Windows features that explicitly considers physical attackers in its threat model. Protecting against physical attacker significantly raises the bar for countermeasures, as these possess far greater capabilities than remote ones.</p>
<h5 id="the-hidden-attack-surface-windows-recovery-environment-winre"><a class="anchor" href="#the-hidden-attack-surface-windows-recovery-environment-winre">#</a> <strong>The Hidden Attack Surface – Windows Recovery Environment (WinRE)</strong></h5>
<p>Naturally, BitLocker’s attack surfaces are shaped by interfaces accessible to an attacker fitting within the BitLocker threat model. As we examined the different interfaces one stood out – the Windows Recovery Environment (WinRE). Any BitLocker attacker can directly boot into WinRE by holding the Shift key while selecting “Restart” from the logon screen.</p>
<p>Figure 2: Booting into WinRE from to logon screen</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LVl2MXJNaQ?image-dimensions=940x343&amp;revision=8" alt="img"></p>
<p>Given WinRE’s fit within the BitLocker threat model, the lack of prior research, and its high vulnerability potential, we decided to conduct security review focused on finding new vulnerabilities, exploiting them, fixing them, and hardening WinRE by mitigating common vulnerability and exploitation patterns. Our end goal was to increase the security and resiliency of both WinRE and BitLocker.</p>
<p>With that in mind, let’s dive into the research journey.</p>
<h3 id="winre-overview"><a class="anchor" href="#winre-overview">#</a> <strong>WinRE Overview</strong></h3>
<h5 id="winre-introduction"><a class="anchor" href="#winre-introduction">#</a> <strong>WinRE Introduction</strong></h5>
<p>WinRE is Windows’s recovery platform – it’s designed to recover from critical system issues such as startup failures, persistent crashes, BitLocker errors, and more.</p>
<p>For example, if your machine crashes, WinRE is the component responsible for analyzing the issue, identifying corruption and resolving it by using its recovery tools.</p>
<p>If you use Windows, chances are that you’ve encountered WinRE at least a few times in your lifetime.</p>
<p>Figure 3: WinRE UI</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LVI1MlZ3Zw?image-dimensions=875x666&amp;revision=8" alt="img"></p>
<h5 id="winre-architecture"><a class="anchor" href="#winre-architecture">#</a> <strong>WinRE Architecture</strong></h5>
<p>Architecturally, WinRE operates with its own standalone OS, known as the Recovery OS. This Recovery OS is a lean version of Windows with recovery-specific customizations.</p>
<p>The recovery customizations include a unique set of recovery tools that are integrated into the known blue screened recovery UI. Among the exposed recovery tools are familiar options such as Startup Repair, System Reset, System Restore, and others.</p>
<p>For storage, the entire Recovery OS - including all executables, DLLs, and drivers - is compressed into a single WIM file named WinRE.wim, which is stored on disk.</p>
<p>Figure 4: Recovery OS compression into WinRE.wim</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWowbllFeQ?image-dimensions=940x333&amp;revision=8" alt="img"></p>
<p>Then, when WinRE boots, the entire WIM file is decompressed from disk into RAM, creating a temporary RAM disk that hosts the Recovery OS runtime. Any changes made within this environment are not saved back to the original WinRE.wim file, making the Recovery OS runtime inherently volatile - modifications are discarded upon reboot.</p>
<p>Figure 5: WinRE.wim RAM disk boot</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LU1mblhvSA?image-dimensions=940x386&amp;revision=8" alt="img"></p>
<h5 id="winre-bitlocker-design-changes"><a class="anchor" href="#winre-bitlocker-design-changes">#</a> <strong>WinRE BitLocker Design Changes</strong></h5>
<p>When BitLocker was first introduced, WinRE had to evolve to support recovery from BitLocker-related failures. This led to several architectural and design changes to enable that recovery functionality. Let’s briefly review these changes.</p>
<h6 id="winre-design-change-1-winrewim-relocation"><a class="anchor" href="#winre-design-change-1-winrewim-relocation">#</a> <strong>WinRE Design Change #1 – WinRE.wim Relocation</strong></h6>
<p>The first design change focused on the location of the compressed Recovery OS –WinRE.wim. This file was moved from residing in the OS volume - now encrypted by BitLocker - to a dedicated unencrypted recovery volume.</p>
<p>This change was required because WinRE must remain accessible in the event of BitLocker failures. If the OS volume is BitLocker-encrypted and becomes unreadable due to a decryption issue, placing WinRE on that volume would block recovery. Since WinRE is a critical component that must be available, it was moved to a separate recovery volume. This helps ensure it can function even if the OS volume is not accessible.</p>
<p>Figure 6: WinRE.wim relocation</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LTRVc3Boeg?image-dimensions=940x467&amp;revision=8" alt="img"></p>
<h6 id="winre-design-change-2-trusted-wim-boot"><a class="anchor" href="#winre-design-change-2-trusted-wim-boot">#</a> <strong>WinRE Design Change #2 – Trusted WIM Boot</strong></h6>
<p>The second design change focused on the integrity of the WinRE.wim file. To support integrity verification of WinRE.wim, a feature called Trusted WIM Boot was introduced. It verifies WinRE’s integrity by comparing its hash to a known-trusted hash.</p>
<p>If the hashes match - the OS volume is automatically unlocked. If hashes don’t match - the OS volume remains locked.</p>
<p>Figure 7: Trusted WIM boot hash comparison</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LXAzOHU3OA?image-dimensions=940x184&amp;revision=8" alt="img"></p>
<p>The two states - auto-unlocked and locked - define the level of access WinRE has to the main OS. In the auto-unlocked state, WinRE has full access to the OS, whereas in the locked state, it has no access at all.</p>
<p>This change was necessary because WinRE now resides on the unencrypted recovery volume and can no longer be blindly trusted. With Trusted WIM Boot, any unauthorized modification to WinRE.wim breaks its trust - effectively blocking any tempering.</p>
<h6 id="winre-design-change-3-volumes-re-lock"><a class="anchor" href="#winre-design-change-3-volumes-re-lock">#</a> <strong>WinRE Design Change #3 – Volumes Re-Lock</strong></h6>
<p>The third design change focused on limiting recovery tools that are inherently risky to BitLocker. For example, among the exposed recovery tools is the Command Prompt. To prevent a scenario where an attacker abuses the command prompt to access BitLocker protected data, a volume re-lock functionality was added to WinRE. This functionality is triggered every time that a risky recovery tool is selected and it re-locks the OS volume. To re-gain access to the OS volume, the user must manually enter the BitLocker recovery key - otherwise, all contents remain completely inaccessible.</p>
<p>Figure 8: WinRE UI Volumes Re-Lock Functionality</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LVY1NDZLSw?image-dimensions=940x143&amp;revision=8" alt="img"></p>
<p>For example, if an attacker launches the Command Prompt recovery tool without inserting the BitLocker recovery key, access to BitLocker-encrypted volumes will be denied, resulting in the following lock error:</p>
<p>Figure 9: WinRE UI Volumes Re-Lock Demonstration</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LXJJalZwcA?image-dimensions=940x550&amp;revision=8" alt="img"></p>
<h5 id="winre-design-changes-summary"><a class="anchor" href="#winre-design-changes-summary">#</a> <strong>WinRE Design Changes Summary</strong></h5>
<p>To summarize the impact of the design changes, as long as WinRE.wim is trusted, and no risky recovery tools are triggered, the OS volume is auto-unlocked allowing WinRE to recover it without requiring any user intervention. In contrast, If WinRE.wim is modified without authorization or a risky recovery tool is triggered, the OS volume is re-locked, preventing WinRE from accessing it.</p>
<h5 id="exposed-attack-surfaces"><a class="anchor" href="#exposed-attack-surfaces">#</a> <strong>Exposed Attack Surfaces</strong></h5>
<p>So now the critical question arises – were any attack surfaces exposed because of these design adjustments?</p>
<p>As it turned out, during the auto-unlock state, WinRE parses files from unprotected volumes - specifically the EFI volume and the recovery volume.</p>
<p>Figure 10: WinRE parsing files from unprotected volumes</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWExTVhvSw?image-dimensions=940x430&amp;revision=8" alt="img"></p>
<p>This parsing presents a very interesting attack surface, which wasn’t valuable to explore before BitLocker’s introduction – since there was no security boundary to cross. Before BitLocker, even full code execution within WinRE didn’t grant a physical attacker any new capabilities. In contrast, with BitLocker, any code execution within WinRE during the auto-unlock state can be utilized to bypass BitLocker and extract all the protected secrets.</p>
<h5 id="this-blog-focus"><a class="anchor" href="#this-blog-focus">#</a> <strong>This Blog Focus</strong></h5>
<p>In this blog, we will focus on exploring 3 such external files –</p>
<ol>
<li>Boot.sdi – located on the recovery volume</li>
<li>ReAgent.xml – located on the recovery volume</li>
<li>Boot Configuration Data (BCD) store – located on the EFI volume</li>
</ol>
<p>Figure 11: Files focused on this blog post</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LVNEbkh6dQ?image-dimensions=940x504&amp;revision=8" alt="img"></p>
<p>The rest of this blog post will be focused on attacking the parsers of each of these files.</p>
<h3 id="attacking-bootsdi-parsing"><a class="anchor" href="#attacking-bootsdi-parsing">#</a> <strong>Attacking Boot.sdi Parsing</strong></h3>
<p>The SDI extension stands for System Deployment Image. SDI files are optionally used when booting from RAM disk.</p>
<p>RAM disk boot is the procedure of extracting and creating a RAM-based disk from a static OS image. Unlike traditional boot scenarios where the OS disk is on a physical storage, in this case, the OS disk is entirely in RAM. Subsequently, disk I/O requests are routed to the RAM disk instead of the physical storage.</p>
<p>One example of RAM disk boot is WinRE boot – where WinRE.wim is the static OS image.</p>
<p>Figure 12: RAM disk boot demonstration</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUhONnJ3aA?image-dimensions=940x318&amp;revision=8" alt="img"></p>
<p>In terms of SDI usage - when specified, the SDI file gets prepended to the virtual disk within the allocated RAM disk memory region.</p>
<p>Figure 13: RAM disk buffer layout with an SDI file</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUlpUkxyRg?image-dimensions=886x842&amp;revision=8" alt="img"></p>
<p>The SDI file format primarily consists of binary blobs, organized through a “blob table” that holds metadata for each blob, including its type, size and relative offset within the file. While we won’t delve into the full SDI format, we’ll focus on the specific blobs specified in the SDI when used to boot WinRE.wim:</p>
<ol>
<li>WIM blob – a blob describing the WIM image</li>
<li>NTFS blob – a blob describing an NTFS volume</li>
</ol>
<p>Below is a demonstration of the entire RAM disk buffer layout. First, the SDI file, containing a WIM blob which points to the WinRE.wim file, and an NTFS blob which points to an empty NTFS volume.</p>
<p>Figure 14: RAM disk buffer layout in WinRE.wim boot</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LVdBRDJvTw?image-dimensions=940x664&amp;revision=8" alt="img"></p>
<p>At this stage, you might wonder why an empty NTFS volume is necessary. It's required to maintain compatibility with Windows components that cannot operate directly on a WIM volume as the OS volume. The empty NTFS volume allows the WIM volume to be presented as a standard NTFS volume, enabling seamless interaction with Windows components that cannot operate directly on WIM volumes.</p>
<p>With better understanding of the SDI file, and the overall RAM disk boot procedure, let’s take a closer look at the code responsible for the RAM disk loading.</p>
<p>Figure 15: RAM Disk loading pseudo code</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUN5UlpuRA?image-dimensions=940x639&amp;revision=8" alt="img"></p>
<p>The code first allocates the RAM disk buffer large enough for both the SDI and WIM files. Then, it loads the SDI file into the allocated buffer. Then, it loads the WIM file into the allocated buffer, following the SDI. The loading API calculates the hash of the loaded WIM file, and this hash is later used as part of the Trusted WIM boot integrity verification. Lastly, the address of the WIM to boot from is calculated by adding the SDI WIM blob specified offset to the start of the RAM disk buffer. <strong>Notably, there is no correlation linking between the verified hashed WIM, and the booted WIM.</strong> The lack of correlation allows setting the WIM offset arbitrarily.</p>
<p>Since we can set the WIM offset arbitrarily, we can append an untrusted WIM to the SDI file and adjust the WIM offset accordingly.</p>
<p>As Trusted WIM boot hash verification uses the hash of the WIM on stored disk rather than the one indicated by the SDI WIM offset, the hash verification will succeed - because the trusted WIM on disk remains unchanged. However, the system will boot using the untrusted WIM specified by the SDI WIM offset.</p>
<p>Below is a demonstration of the entire RAM disk buffer layout the exploitation scenario.</p>
<p>Figure 16: RAM disk buffer layout in exploitation scenario</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUtQckVzMA?image-dimensions=940x690&amp;revision=8" alt="img"></p>
<p>This vulnerability allows bypassing the Trusted WIM boot verification – we can boot an untrusted WIM as trusted, and have our untrusted WIM benefit the auto-unlock functionality – thereby bypassing BitLocker and extracting the secrets.</p>
<p>To demonstrate secrets extraction, we created a clone of WinRE.wim with and changed its launch app to the Command Prompt, instead of the recovery environment program. Then, appended this WIM to Boot.sdi, verified offsets are correct, and booted into WinRE. The result was the Command Prompt being launched in auto-unlock state.</p>
<p>Figure 17: Demo – cmd.exe in auto-unlock – launched from untrusted WIM</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LU9QRlVlSw?image-dimensions=940x501&amp;revision=8" alt="img"></p>
<p>This vulnerability was patched in 2025’s July Patch Tuesday and received the ID of <strong>CVE-2025-48804</strong>.</p>
<h3 id="attacking-reagentxml-parsing"><a class="anchor" href="#attacking-reagentxml-parsing">#</a> <strong>Attacking ReAgent.xml Parsing</strong></h3>
<p>The ReAgent.xml file represents the current recovery state and configuration of WinRE.</p>
<p>Figure 18: ReAgent.xml</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LU1Ta1BtOQ?image-dimensions=940x445&amp;revision=8" alt="img"></p>
<p>In the early stages of WinRE runtime, it parses this XML file.</p>
<h5 id="reagentxml-scheduled-operations"><a class="anchor" href="#reagentxml-scheduled-operations">#</a> <strong>ReAgent.xml Scheduled Operations</strong></h5>
<p>Among the interesting fields in the XML file is the “ScheduledOperation” field. This field instructs WinRE to run a recovery operation by ID. The supported operations include the known recovery tools such as startup repair, system reset and others.</p>
<p>Simply, scheduled operations offer an alternative method to execute recovery tools in WinRE. As opposed to the known execution method, which is triggered manually through the WinRE UI, scheduled operations, if specified, execute automatically before the UI is displayed.</p>
<p>Additionally, risky scheduled operations (e.g. Command Prompt), would trigger the re-lock functionality.</p>
<p>Figure 19: Scheduled Operations</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LVlCQjNqZA?image-dimensions=940x116&amp;revision=8" alt="img"></p>
<p>In this blog post, we will focus on two scheduled operations –</p>
<ol>
<li>Offline Scanning</li>
<li>WinRE Apps</li>
</ol>
<h5 id="offline-scanning-scheduled-operation"><a class="anchor" href="#offline-scanning-scheduled-operation">#</a> <strong>Offline Scanning Scheduled Operation</strong></h5>
<p>The offline scanning scheduled operation allows running Anti-Virus scan from within WinRE against the OS volume. This functionality is beneficial against malware that does not persist in WinRE runtime.</p>
<p>Figure 20: Offline Scanning Scheduled Operation Demonstration</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWtUY1MxMA?image-dimensions=925x396&amp;revision=8" alt="img"></p>
<p>To avoid misuse of this feature, which runs in the auto-unlock state, there are multiple limitations that narrow down the apps allowed to perform Offline Scanning –</p>
<ol>
<li>Offline Scanning apps are executed from the offline OS volume</li>
<li>Offline Scanning apps must be digitally signed by Microsoft or WHQL</li>
<li>The digital signature must be embedded in the app (not catalog signed)</li>
</ol>
<p>Of course, a BitLocker attacker can’t insert his own signed app, as the OS volume is assumed BitLocker encrypted, and out of attacker’s reach.</p>
<p>Figure 21: Offline Scanning App Execution and Limitations</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUxmNms4bw?image-dimensions=940x438&amp;revision=8" alt="img"></p>
<p>We enumerated the applicable apps and discovered approximately 30. No, the Command Prompt is not among them. Additionally, most of the applicable applications could not execute in WinRE mainly due to compatibility reasons.</p>
<p>We reviewed allowed and applicable apps one by one to see if they could potentially be mis-used. That’s when we found that the tttracer.exe app fits within the limitation.</p>
<p>Tttracer.exe is a time-travel debugging utility that supports tracing arbitrary apps. WinRE does not enforce strict validation of the Offline Scanning app arguments, which is reasonable given that each app may use a different argument format. As a result, it's possible to trace Command Prompt (cmd.exe) under tttracer.exe without triggering the re-lock functionality. The traced cmd.exe will benefit the auto-unlock functionality – thereby bypassing BitLocker and extracting the secrets.</p>
<p>Figure 22: Exploiting the allowed tttracer.exe to proxy-execute cmd.exe</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LURPdlNBeg?image-dimensions=841x439&amp;revision=8" alt="img"></p>
<p>Figure 23: Demo – cmd.exe in auto-unlock - traced by tttracer.exe</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUNRNGVpUg?image-dimensions=940x501&amp;revision=8" alt="img"></p>
<p>This vulnerability was patched in 2025’s July Patch Tuesday and received the ID of <strong>CVE-2025-48800</strong>.</p>
<h5 id="winre-apps-scheduled-operation"><a class="anchor" href="#winre-apps-scheduled-operation">#</a> <strong>WinRE Apps Scheduled Operation</strong></h5>
<p>The WinRE apps scheduled operation simply allows running apps within WinRE. Specified apps are verified before benefiting from the auto-unlock functionality. Only those that pass verification can leverage auto-unlock, which is particularly useful for apps that require access to the BitLocker-encrypted OS volume.</p>
<p>Figure 24: WinRE Apps Scheduled Operation Demonstration</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUM4a1V5WA?image-dimensions=940x211&amp;revision=8" alt="img"></p>
<p>The trust verification is based on a simple comparison of the executed app name and hash against a pre-defined list of allowed entries.</p>
<p>The list of allowed entries is stored in the WinRE registry, which is part of the WinRE.wim file. Since WinRE.wim is integrity-protected by Trusted WIM boot verification, a BitLocker attacker cannot modify the registry to insert unauthorized entries - doing so would break the WIM trust.</p>
<p>Figure 25: WinRE Apps Verification</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LVRnaTA4MA?image-dimensions=940x265&amp;revision=8" alt="img"></p>
<p>Similarly to the Offline Scanning operation research – we find that the verifications are implemented correctly, and we can’t directly execute our own custom apps. That said, the same question arises: any existing trusted apps that could be mis-used?</p>
<p>We enumerated the allowed entries list and found one registered trusted app - SetupPlatform.exe. This app is registered as trusted during Windows Upgrade. Only once the upgrade is completed, the trusted app entry remains in the allowed list and is not removed.</p>
<p>This adds SetupPlatform.exe as a potential attack surface, since it can be executed in the auto-unlock state.</p>
<p>We then delve deeper into SetupPlatform.exe and found that it has an execution path that registers the Shift+F10 hotkey as cmd.exe launcher. When triggered, this hotkey launches cmd.exe without re-locking the OS volume. This mechanism is used to facilitate troubleshooting during upgrade failures.</p>
<p>The first thing we tried to do is to schedule the SetupPlatform.exe WinRE app and see if we can trigger the Shift+F10 hotkey to interact with cmd.exe. We failed. It turned out that even though the desired execution path is triggered, it immediately exits due to missing configuration on the OS volume.</p>
<p>Figure 26: SetupPlatform.exe execution flow</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LTdkSm1tag?image-dimensions=940x297&amp;revision=8" alt="img"></p>
<p>Of course, a BitLocker attacker can’t create the configuration, as the OS volume is assumed BitLocker encrypted, and out of attacker’s reach.</p>
<p>The time window between the hotkey registration and the termination is too short, making it impossible to manually trigger.</p>
<p>Figure 27: Impossible time Window</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUszUmxVdQ?image-dimensions=940x334&amp;revision=8" alt="img"></p>
<p>We decided to dig even deeper into SetupPlatform.exe, to see if other execution paths may help widening the short time window. That’s when we discovered an interesting flow. It turned out that after the hotkey registration, the app can spawn a blocking message box. The decision on whether to spawn this message box is based on an INI file that is searched for in the recovery volume, which is under out full control.</p>
<p>Figure 28: Creating an infinite time window</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWhmR0V2Zw?image-dimensions=940x281&amp;revision=8" alt="img"></p>
<p>By configuring this INI file correctly, we can create an infinite time window that would allow triggering the Shift+F10 hotkey to launch and interact with cmd.exe. The launched cmd.exe will benefit the auto-unlock functionality – thereby bypassing BitLocker and extracting the secrets.</p>
<p>Figure 29: Demo – cmd.exe in auto-unlock – launched via Shift+F10 hotkey</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUtPVEpDQg?image-dimensions=940x507&amp;revision=8" alt="img"></p>
<p>This vulnerability was patched in 2025’s July Patch Tuesday and received the ID of <strong>CVE-2025-48003</strong>.</p>
<h3 id="attacking-boot-configuration-data-bcd-parsing"><a class="anchor" href="#attacking-boot-configuration-data-bcd-parsing">#</a> <strong>Attacking Boot Configuration Data (BCD) Parsing</strong></h3>
<p>BCD stands for Boot Configuration Data, and it’s the file that defines how Windows boots. It stores boot entries, controls the boot parameters, recovery settings and many more boot-related configurations.</p>
<p>Figure 30: BCD store</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LXpudDJBVA?image-dimensions=940x623&amp;revision=8" alt="img"></p>
<p>In the context of WinRE, the usage of BCD is minimal - as most BCD parsing occurs during the boot phase - prior to the WinRE runtime.</p>
<p>WinRE uses BCD mainly to determine the location of the target OS volume on disk, so that it knows which volume to aim the recovery operations to. Specifically, the OS device BCD element is the element queried by WinRE to calculate the target volume location. This element can point to any volume on disk, though by default, it points to the OS volume – commonly mapped to the C: drive.</p>
<p>Figure 31: WinRE BCD Usage Demonstration</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWJ6cWR0Nw?image-dimensions=940x291&amp;revision=8" alt="img"></p>
<p>The first question that came into our minds when we investigated WinRE BCD usage, is what can we potentially gain from targeting BCD in the context of WinRE?</p>
<p>As it turned out - WinRE fully trusts the target OS it recovers, and it sometimes queries sensitive configuration from that target OS, assuming it’s out of attacker’s reach. This assumption is solid from a design perspective, because with BitLocker enabled, the target OS is encrypted, and the attacker has no access whatsoever.</p>
<p>Having said that, we wondered, can we challenge this assumption that target OS is out of attacker’s reach?</p>
<h5 id="hunting-target-os-location-impersonation-primitive"><a class="anchor" href="#hunting-target-os-location-impersonation-primitive">#</a> <strong>Hunting Target OS Location Impersonation Primitive</strong></h5>
<p>What if we could trick WinRE into thinking that an attacker-controlled volume is the trusted BitLocker-encrypted one? Our focus has shifted toward identifying a primitive that allows impersonation of the target OS location. The goal is to manipulate the osdevice element so that it points to an attacker-controlled volume - such as the Recovery volume - instead of pointing to the trusted, BitLocker-encrypted volume.</p>
<p>This primitive, if gained, would break the trust assumption.</p>
<p>Figure 32: Desired Primitive Demonstration</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LXl6M2ZaVg?image-dimensions=940x354&amp;revision=8" alt="img"></p>
<p>We already know that the OS device is controlled in the BCD store, which we can directly modify – as it resides on the EFI volume. One might think, why can’t you just change the device directly in the BCD?</p>
<p>Well, theoretically, it’s possible, but it isn’t valuable. Let me explain - the OS device location isn’t used only by WinRE, but also by the Boot Manager – which uses it to know which volume it should auto-unlock. The challenge here is that the same store is used in both the boot and OS phases, so any change will affect both.</p>
<p>In this scenario, modifying the OS device location to point to the Recovery volume prevents the Boot Manager from auto-unlocking the BitLocker-encrypted OS volume that contains the secrets. This is because the OS volume is no longer associated with the WinRE boot. While this scenario could theoretically break the trust assumption, it still wouldn’t allow extraction of BitLocker secrets - even with full code execution in WinRE.</p>
<p>Figure 33: Directly Modifying OS device – not valuable</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWFRdENBcA?image-dimensions=940x333&amp;revision=8" alt="img"></p>
<p>Our primitive must not interfere with the boot procedure and the auto-unlock functionality. We must go deeper.</p>
<p>We decided to dig deeper into the way WinRE searches for the BCD store. Any potential flaws at this stage wouldn’t interfere with the boot procedure or the auto-unlock functionality, as it occurs after the boot is completed.</p>
<p>To locate the BCD store - WinRE iterates over disk volumes and searches each one for a BCD store. The first store found is the one used to further calculate the target OS location.</p>
<p>Figure 34: WinRE BCD lookup logic demonstration</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWJnZGNNdg?image-dimensions=900x393&amp;revision=8" alt="img"></p>
<p>This volume iteration is an interesting point to further inspect – because only EFI volume contain the BCD store. Any attempt to locate the store on other volumes could be potentially abused.</p>
<p>The functions used to iterate over volumes are <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findfirstvolumew">FindFirstVolume</a> and <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findnextvolumew">FindNextVolume</a>. Notably, the remarks section highlights a very interesting point:</p>
<p><em>“You should not assume any correlation between the order of the volumes that are returned by these functions and the order of the volumes that are on the computer. In particular, do not assume any correlation between volume order and drive letters as assigned by the BIOS (if any) or the Disk Administrator.”</em></p>
<p>Under the hood, these functions perform further filtering which causes an inconsistency in the returned volume order.</p>
<p>The typical volume order, returned by diskpart list vol command is as follows –</p>
<ol>
<li>OS volume</li>
<li>EFI volume</li>
<li>Recovery volume</li>
</ol>
<p>Figure 35: diskpart list vol command output</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUROamxIVQ?image-dimensions=940x180&amp;revision=8" alt="img"></p>
<p>However, the volume iteration functions would return a different order –</p>
<ol>
<li>OS volume</li>
<li>Recovery volume</li>
<li>EFI volume</li>
</ol>
<p>Can you spot the inconsistency? With the volume iteration functions, the Recovery volume is iterated over and checked for a BCD store before the EFI volume.</p>
<p>By placing a custom, attacker-controlled store in the recovery volume – we can trick WinRE into using it, instead of using the boot store. With this setup, WinRE doesn’t even reach the point of querying the EFI volume.</p>
<p>Figure 36: Exploiting the volume iteration order</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LXB0dUdDbA?image-dimensions=940x625&amp;revision=8" alt="img"></p>
<p>Any modification or corruption we make to that attacker store will only impact WinRE and will not disrupt the boot procedure at all!</p>
<p>This flaw allows us to achieve the desired primitive: during the boot phase, the boot manager locates and uses a legitimate BCD store from the EFI volume to unlock BitLocker-encrypted OS volume. In the boot phase, there are no issues in the BCD store lookup logic.</p>
<p>Figure 37: BCD usage in boot phase – EFI volume BCD store is used</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWFYMUZEVw?image-dimensions=940x262&amp;revision=8" alt="img"></p>
<p>However, during the OS phase, WinRE instead locates and uses the attacker-controlled BCD store in the recovery volume - leading it to recover an attacker-controlled volume.</p>
<p>Figure 38: BCD usage in WinRE phase – Recovery volume BCD store is used</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LWc1WmJwZw?image-dimensions=940x280&amp;revision=8" alt="img"></p>
<h5 id="going-beyond-theoretical-concepts-exploitation-strategy"><a class="anchor" href="#going-beyond-theoretical-concepts-exploitation-strategy">#</a> <strong>Going Beyond Theoretical Concepts – Exploitation Strategy</strong></h5>
<p>We successfully gained the desired primitive, but can it be further leveraged to extract BitLocker secrets?</p>
<p>The reason we went after this primitive is because it allows us to break WinRE’s assumption that the target OS is out of attacker’s reach. However, given its novelty and unexplored exploitability, it was our responsibility to move beyond theoretical concepts and develop a fully functional exploit.</p>
<p>To do so, we came up with the following exploitation strategy: Find a WinRE flow with two characteristics -</p>
<ol>
<li>A flow that does not trigger the volumes re-lock functionality</li>
<li>A flow that queries configuration from the target OS to perform operations</li>
</ol>
<p>The idea is to chain this WinRE flow with the gained impersonation primitive – to trigger sensitive operations in the auto-unlock state.</p>
<p>After exploring different WinRE behaviors, we found a potential candidate - the Push Button Reset (PBR) feature. PBR is Windows’s system reset tool, and it provides various reset functionalities.</p>
<p>Figure 39: Push Button Reset Demonstration</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUpZcGEybA?image-dimensions=940x710&amp;revision=8" alt="img"></p>
<p>PBR supports multiple trigger modes, with one of its modes, known as “Online PBR” meeting the characteristics we defined for the exploit -</p>
<ol>
<li>It does not trigger the re-lock functionality – thereby benefited the auto-unlock functionality</li>
<li>It queries configuration from the target OS to perform sensitive operations – thereby can be controlled with the impersonation primitive</li>
</ol>
<p>Additionally, Online PBR can be scheduled freely through ReAgent.xml’s scheduled operations.</p>
<p>With full control over the PBR configuration, the remaining task was to determine the exact sensitive directive required to extract BitLocker secrets. We found that the ResetSession.xml file - responsible for defining all operations executed by PBR - includes the DecryptVolume directive, which instructs PBR to decrypt any arbitrary BitLocker-encrypted volume -</p>
<p>Figure 40: PBR ResetSession.xml BitLocker Volume Decryption</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LUMwemNIWQ?image-dimensions=940x287&amp;revision=8" alt="img"></p>
<h5 id="full-exploit-chain"><a class="anchor" href="#full-exploit-chain">#</a> <strong>Full Exploit Chain</strong></h5>
<p>We now have all the pieces required for the full BitLocker bypass exploit chain. The exploit required creating and modifying few files on the Recovery volume -</p>
<ol>
<li>The BCD store – with the OS device element pointing to the Recovery volume</li>
<li>The PBR configuration – with the DecryptVolume PBR operation specifying the BitLocker-encrypted OS volume as the volume to decrypt</li>
<li>The ReAgent.xml file – with Online PBR scheduled operation</li>
</ol>
<p>Figure 41: Exploitation setup</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LVlndUFOdQ?image-dimensions=940x375&amp;revision=8" alt="img"></p>
<p>With this setup, the next WinRE boot will go through the Online PBR flow. During the BCD store lookup, PBR will locate the attacker's BCD store and mistakenly identify its target volume as the Recovery volume. Consequently, PBR will load its configuration from the Recovery volume, which instructs it to decrypt the BitLocker-encrypted OS volume. Once PBR completes its process, BitLocker secrets become freely accessible, as BitLocker was disabled by PBR.</p>
<p>Figure 42: Exploitation flow</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LU9RckphUw?image-dimensions=940x458&amp;revision=8" alt="img"></p>
<p>Figure 43: Demo – cmd.exe with OS volume fully-decrypted</p>
<p><img loading="lazy" src="https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDQyODA2LTF1YVNVdA?image-dimensions=940x501&amp;revision=8" alt="img"></p>
<p>This vulnerability and the entire exploitation chain was patched in 2025’s July Patch Tuesday and received the ID of <strong>CVE-2025-48818.</strong></p>
<h3 id="vulnerability-fixes"><a class="anchor" href="#vulnerability-fixes">#</a> <strong>Vulnerability Fixes</strong></h3>
<p>All the discovered vulnerabilities and exploitation techniques were fixed in 2025’s July Patch Tuesday. The assigned IDs are –</p>
<ul>
<li>CVE-2025-48800</li>
<li>CVE-2025-48003</li>
<li>CVE-2025-48804</li>
<li>CVE-2025-48818</li>
</ul>
<h3 id="bitlocker-countermeasures"><a class="anchor" href="#bitlocker-countermeasures">#</a> <strong>BitLocker Countermeasures</strong></h3>
<p>To further enhance the security of BitLocker, we recommend enabling TPM+PIN for pre-boot authentication. This significantly reduces the BitLocker attack surfaces by limiting exposure to only the TPM.</p>
<p>To mitigate BitLocker downgrade attacks, we advise enabling the <a target="_blank" rel="noopener" href="https://support.microsoft.com/en-us/topic/how-to-manage-the-windows-boot-manager-revocations-for-secure-boot-changes-associated-with-cve-2023-24932-41a975df-beb2-40c1-99a3-b3ff139f832d">REVISE mitigation</a>. This mechanism enforces secure versioning across critical boot components, preventing downgrades that could reintroduce known vulnerabilities in BitLocker and Secure Boot.</p>
<p>For more information about BitLocker countermeasures, please read the “BitLocker Countermeasures” article: <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/security/operating-system-security/data-protection/bitlocker/countermeasures">BitLocker countermeasures | Microsoft Learn</a></p>
<h3 id="closing-remarks"><a class="anchor" href="#closing-remarks">#</a> <strong>Closing Remarks</strong></h3>
<p>To wrap up - we want to emphasize that our journey never ends, we continue to proactively research BitLocker, WinRE and the related components with the never-ending goal of increasing their security and resiliency.</p>
<h3 id="about-the-storm-researchers"><a class="anchor" href="#about-the-storm-researchers">#</a> <strong>About the STORM Researchers</strong></h3>
<p>This blog is a joint work by Netanel Ben Simon and Alon Leviev, security researchers working with the Security Testing &amp; Offensive Research at Microsoft (STORM).</p>
<p>The STORM team mission is to unlock engineers’ security excellence and focus our expertise to ensure Azure Edge &amp; Platform products are secure and trusted. We aim to reduce security risks in shipped and soon-to-be-shipped products.</p>
<p>Updated Aug 15, 2025</p>
<div class="tags"><a href="/tags/Security/" rel="tag"><i class="ic i-tag"></i>Security</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-eye"></i></span><span class="text">Total Views: </span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/2025/12/10/privacy/Bitunlocker/">Loading...</span></span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">Edited on </span><time title="Modified: 2025-12-10 22:39:32" itemprop="dateModified" datetime="2025-12-10T22:39:32+08:00">2025-12-10</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" src="/assets/monero.avif" alt="AUVeggry monero"><p>monero</p></div><div><img loading="lazy" src="/assets/bitcoin.avif" alt="AUVeggry Bitcoin"><p>Bitcoin</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>AUVeggry<i class="ic i-at"><em>@</em></i>sakura"s blog"</li><li class="link"><strong>Post link: </strong><a href="https://sakurame.eu.org/2025/12/10/privacy/Bitunlocker/" title="BitUnlocker - Leveraging Windows Recovery to Extract BitLocker Secrets">https://sakurame.eu.org/2025/12/10/privacy/Bitunlocker/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/06/03/thinking/%E8%87%B4%E6%95%AC%E6%9D%BF%E7%A0%96%E7%BE%8E%E5%AD%A6/" rel="prev" itemprop="url" data-background-image="https://ptpimg.me/b3w739.jpg" title="致敬板砖美学之长寿板砖蓝天P775DM2笔记本电脑评测(转载自Bob's Coding Lab)"><span class="type">Previous Post</span><span class="category"><i class="ic i-flag"></i>思考随笔记录</span><h3>致敬板砖美学之长寿板砖蓝天P775DM2笔记本电脑评测(转载自Bob's Coding Lab)</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#bitunlocker-leveraging-windows-recovery-to-extract-bitlocker-secrets"><span class="toc-number">1.</span> <span class="toc-text"> BitUnlocker: Leveraging Windows Recovery to Extract BitLocker Secrets</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#table-of-contents"><span class="toc-number">1.0.0.0.1.</span> <span class="toc-text"> Table of Contents</span></a></li></ol></li></ol><li class="toc-item toc-level-3"><a class="toc-link" href="#introduction"><span class="toc-number">1.0.1.</span> <span class="toc-text"> Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bitlocker-overview"><span class="toc-number">1.0.2.</span> <span class="toc-text"> BitLocker Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bitlocker-threat-model"><span class="toc-number">1.0.2.0.1.</span> <span class="toc-text"> BitLocker Threat Model</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#the-hidden-attack-surface-windows-recovery-environment-winre"><span class="toc-number">1.0.2.0.2.</span> <span class="toc-text"> The Hidden Attack Surface – Windows Recovery Environment (WinRE)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#winre-overview"><span class="toc-number">1.0.3.</span> <span class="toc-text"> WinRE Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#winre-introduction"><span class="toc-number">1.0.3.0.1.</span> <span class="toc-text"> WinRE Introduction</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#winre-architecture"><span class="toc-number">1.0.3.0.2.</span> <span class="toc-text"> WinRE Architecture</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#winre-bitlocker-design-changes"><span class="toc-number">1.0.3.0.3.</span> <span class="toc-text"> WinRE BitLocker Design Changes</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#winre-design-change-1-winrewim-relocation"><span class="toc-number">1.0.3.0.3.1.</span> <span class="toc-text"> WinRE Design Change #1 – WinRE.wim Relocation</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#winre-design-change-2-trusted-wim-boot"><span class="toc-number">1.0.3.0.3.2.</span> <span class="toc-text"> WinRE Design Change #2 – Trusted WIM Boot</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#winre-design-change-3-volumes-re-lock"><span class="toc-number">1.0.3.0.3.3.</span> <span class="toc-text"> WinRE Design Change #3 – Volumes Re-Lock</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#winre-design-changes-summary"><span class="toc-number">1.0.3.0.4.</span> <span class="toc-text"> WinRE Design Changes Summary</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#exposed-attack-surfaces"><span class="toc-number">1.0.3.0.5.</span> <span class="toc-text"> Exposed Attack Surfaces</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#this-blog-focus"><span class="toc-number">1.0.3.0.6.</span> <span class="toc-text"> This Blog Focus</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#attacking-bootsdi-parsing"><span class="toc-number">1.0.4.</span> <span class="toc-text"> Attacking Boot.sdi Parsing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#attacking-reagentxml-parsing"><span class="toc-number">1.0.5.</span> <span class="toc-text"> Attacking ReAgent.xml Parsing</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#reagentxml-scheduled-operations"><span class="toc-number">1.0.5.0.1.</span> <span class="toc-text"> ReAgent.xml Scheduled Operations</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#offline-scanning-scheduled-operation"><span class="toc-number">1.0.5.0.2.</span> <span class="toc-text"> Offline Scanning Scheduled Operation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#winre-apps-scheduled-operation"><span class="toc-number">1.0.5.0.3.</span> <span class="toc-text"> WinRE Apps Scheduled Operation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#attacking-boot-configuration-data-bcd-parsing"><span class="toc-number">1.0.6.</span> <span class="toc-text"> Attacking Boot Configuration Data (BCD) Parsing</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#hunting-target-os-location-impersonation-primitive"><span class="toc-number">1.0.6.0.1.</span> <span class="toc-text"> Hunting Target OS Location Impersonation Primitive</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#going-beyond-theoretical-concepts-exploitation-strategy"><span class="toc-number">1.0.6.0.2.</span> <span class="toc-text"> Going Beyond Theoretical Concepts – Exploitation Strategy</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#full-exploit-chain"><span class="toc-number">1.0.6.0.3.</span> <span class="toc-text"> Full Exploit Chain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vulnerability-fixes"><span class="toc-number">1.0.7.</span> <span class="toc-text"> Vulnerability Fixes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bitlocker-countermeasures"><span class="toc-number">1.0.8.</span> <span class="toc-text"> BitLocker Countermeasures</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#closing-remarks"><span class="toc-number">1.0.9.</span> <span class="toc-text"> Closing Remarks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#about-the-storm-researchers"><span class="toc-number">1.0.10.</span> <span class="toc-text"> About the STORM Researchers</span></a></li></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/2023/04/24/privacy/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84UEFI%E4%BF%A1%E4%BB%BB%E9%93%BE/" rel="bookmark" title="从零开始构建自己的UEFI信任链">从零开始构建自己的UEFI信任链</a></li><li><a href="/2023/05/25/privacy/%E9%9A%90%E7%A7%81%E4%BF%9D%E6%8A%A4%E6%8C%87%E5%8D%97%EF%BC%88%E9%95%BF%E6%9C%9F%E7%BF%BB%E8%AF%91%E9%A1%B9%E7%9B%AE%EF%BC%89/" rel="bookmark" title="隐私保护指南（长期翻译项目）">隐私保护指南（长期翻译项目）</a></li><li><a href="/2023/06/09/privacy/PGP%E7%9A%84%E9%97%AE%E9%A2%98/" rel="bookmark" title="PGP的问题">PGP的问题</a></li><li><a href="/2023/06/09/privacy/the-pgp-problem/" rel="bookmark" title="the-pgp-problem">the-pgp-problem</a></li><li><a href="/2024/03/14/privacy/Canokey%E4%B8%8D%E5%AE%8C%E5%85%A8%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97-%E6%8C%81%E7%BB%AD%E8%B8%A9%E5%9D%91%E4%B8%AD/" rel="bookmark" title="Canokey不完全食用指南--持续踩坑中">Canokey不完全食用指南--持续踩坑中</a></li><li><a href="/2024/03/21/privacy/%E6%9F%90%E7%A7%91%E5%AD%A6%E7%9A%84PGP%E7%AE%97%E5%8F%B7%E6%8C%87%E5%8D%97/" rel="bookmark" title="某科学的PGP算号指南">某科学的PGP算号指南</a></li><li class="active"><a href="/2025/12/10/privacy/Bitunlocker/" rel="bookmark" title="BitUnlocker - Leveraging Windows Recovery to Extract BitLocker Secrets">BitUnlocker - Leveraging Windows Recovery to Extract BitLocker Secrets</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="AUVeggry" src="/assets/avatar.avif"><p class="name" itemprop="name">AUVeggry</p><div class="description" itemprop="description">The spirit of independence and the freedom of thought </div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">65</span><span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span><span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">22</span><span class="name">tags</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/auveggry" class="item github" title="https://github.com/auveggry"><i class="ic i-github"></i></a><a href="mailto:mail@sakurame.eu.org" class="item email" title="mailto:mail@sakurame.eu.org"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-user"></i>About</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About This Site</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>Appreciation</a></li><li class="item"><a href="/privacy/" rel="section"><i class="ic i-user"></i>Privacy Policy</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-sakura"></i>Friends</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/06/03/thinking/%E8%87%B4%E6%95%AC%E6%9D%BF%E7%A0%96%E7%BE%8E%E5%AD%A6/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div><div id="player"></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="In视频压制技术">视频压制技术</a></div><span><a href="/2023/06/11/vcbstudio/%E7%A5%9E%E4%B8%80%E6%A0%B7%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%AC/">神一样的工具们</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="In游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/28/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89/">games104系列笔记（十六）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="In游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/28/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%E4%B8%80%EF%BC%89/">games104系列笔记（二一）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/game-engine/" title="In游戏引擎实践">游戏引擎实践</a></div><span><a href="/2023/06/25/game-engine/games104%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/">games104系列笔记（一）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="In视频压制技术">视频压制技术</a></div><span><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%85%AD%E7%AB%A0VS%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C/">第六章VS基础滤镜</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="In视频压制技术">视频压制技术</a></div><span><a href="/2023/06/11/vcbstudio/%E8%AE%A4%E8%AF%86%E7%91%95%E7%96%B5/">认识瑕疵</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="In视频压制技术">视频压制技术</a></div><span><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%89%E7%AB%A0%E7%A5%9E%E4%B8%80%E6%A0%B7%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%AC/">第三章神一样的工具们</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="In视频压制技术">视频压制技术</a></div><span><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E8%AE%A4%E8%AF%86%E8%A7%86%E9%A2%91/">第一章从零开始认识视频</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vcbstudio/" title="In视频压制技术">视频压制技术</a></div><span><a href="/2024/03/16/vcbstudio/%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%88%9D%E7%AD%8930fps%E5%A4%84%E7%90%86/">第十章初等30fps处理</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/privacy/" title="In隐私保护指北">隐私保护指北</a></div><span><a href="/2023/06/09/privacy/PGP%E7%9A%84%E9%97%AE%E9%A2%98/">PGP的问题</a></span></li></ul></div><div class="rpost pjax"><h2>Recent Comments</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">© 2023 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">AUVeggry @ Sakura's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="Symbols count total">1.2m words</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="Reading time total">17:47</span></div><div class="powered-by">Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> &amp; Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div><br><span style="display:inline;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:var(--grey-5);"><a target="_blank" rel="noopener" href="https://icp.gov.moe/?keyword=20233555">萌ICP备20233555号</a></span></div></div></footer></div><script data-config="" type="text/javascript">var LOCAL = {
    ispost: true,
    path: `2025/12/10/privacy/Bitunlocker/`,
    favicon: {
        show: `(●´3｀●) Here we go again.`,
        hide: `(´Д｀) It's a disaster!`
    },
    search: {
        placeholder: "Search for Posts",
        empty: "We didn't find any results for the search: ${query}",
        stats: "${hits} results found in ${time} ms"
    },
    nocopy: "false",
    copyright: `Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.`,
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">Article Timeliness Alert</span><br>This is an article published {{publish}} days ago and last updated {{updated}} days ago. Some information may have changed, so please be careful to screen it.</p></div>`,
    quiz: {
        choice: `Multiple Choice`,
        multiple: `Multiple Answer`,
        true_false: `True/False`,
        essay: `Questions`,
        gap_fill: `Gap Filling`,
        mistake: `Wrong Answer`
    }
};
</script><script src="/js/siteInit.js?v=0.5.4" type="module" fetchpriority="high" defer=""></script></body></html>